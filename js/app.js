function onDeviceReady(){if(navigator.splashscreen.hide(),!empty(krms_config.pushNotificationSenderid)){var e=PushNotification.init({android:{senderID:krms_config.pushNotificationSenderid},ios:{alert:"true",badge:"true",sound:"true",clearBadge:"true"},windows:{}});e.on("registration",function(e){setStorage("device_id",e.registrationId);var t="registrationId="+e.registrationId;t+="&device_platform="+device.platform,t+="&client_token="+getStorage("client_token"),callAjax("registerMobile",t)}),e.on("notification",function(e){e.additionalData.foreground?(playNotification(),"order"==e.additionalData.additionalData.push_type?showNotification(e.title,e.message):showNotificationCampaign(e.title,e.message)):"order"==e.additionalData.additionalData.push_type?showNotification(e.title,e.message):showNotificationCampaign(e.title,e.message)}),e.on("error",function(e){}),e.finish(function(){})}}function noNetConnection(){toastMsg(getTrans("Internet connection lost","net_connection_lost"))}function dump(e){console.debug(e)}function setStorage(e,t){localStorage.setItem(e,t)}function getStorage(e){return localStorage.getItem(e)}function removeStorage(e){localStorage.removeItem(e)}function explode(e,t){var a=t.split(e);return a}function urlencode(e){return encodeURIComponent(e)}function refreshConnection(){hasConnection()?($(".home-page").show(),$(".no-connection").hide()):($(".home-page").hide(),$(".no-connection").show())}function hasConnection(){return isDebug()?!0:!0}function geoComplete(){dump("country_code_set=>"+getStorage("country_code_set")),empty(getStorage("country_code_set"))?empty(getStorage("mobile_country_code"))?$("#s").geocomplete():($("#s").geocomplete({country:getStorage("mobile_country_code")}),setStorage("country_code_set",getStorage("mobile_country_code"))):$("#s").geocomplete({country:getStorage("country_code_set")})}function createElement(e,t){var a=document.getElementById(e);a.innerHTML=t,ons.compile(a)}function searchMerchant(){var e=($("#s").val(),$.trim($("#parish").val())),t=$.trim($("#cuisine").val());setStorage("parish",e),setStorage("cuisine",t),removeStorage("merchant_id"),removeStorage("shipping_address"),removeStorage("merchant_id"),removeStorage("transaction_type"),removeStorage("merchant_logo"),removeStorage("order_total"),removeStorage("merchant_name"),removeStorage("total_w_tax"),removeStorage("currency_code"),removeStorage("paymet_desc"),removeStorage("order_id"),removeStorage("order_total_raw"),removeStorage("cart_currency_symbol"),removeStorage("paypal_card_fee"),removeStorage("cart_sub_total"),removeStorage("cart_delivery_charges"),removeStorage("cart_packaging"),removeStorage("cart_tax"),removeStorage("map_address_result_formatted_address"),removeStorage("customer_contact_number");var a={parish:e,cuisine:t,closeMenu:!0,animation:"slide"};menu.setMainPage("searchResults.html",a)}function searchResultCallBack(e){search_address=e}function showFilterOptions(e){"undefined"==typeof navDialog||null==navDialog||""==navDialog||"object"==typeof navDialog?(1==e&&("undefined"!=typeof navDialog&&navDialog.destroy(),ons.createDialog("filterOptons.html").then(function(e){e.show(),translatePage()})),2==e&&("undefined"!=typeof navDialog&&navDialog.destroy(),ons.createDialog("tableBookingfilterOptons.html").then(function(e){e.show(),translatePage()})),3==e&&("undefined"!=typeof navDialog&&navDialog.destroy(),ons.createDialog("filterOpton.html").then(function(e){e.show(),translatePage()}))):navDialog.show()}function applyFilter(e){navDialog.hide();var t="";$(".delivery_type").exists()&&$.each($(".delivery_type:checked"),function(e,a){t+=$(this).val()+","}),dump("services=>"+t);var a="";$(".cuisine_type").exists()&&$.each($(".cuisine_type:checked"),function(e,t){a+=$(this).val()+","}),dump("cuisine_type=>"+a),1==e&&callAjax("search","type="+e+"&address="+getStorage("search_address")+"&services="+t+"&cuisine_type="+a+"&restaurant_name="+$(".restaurant_name").val()),2==e&&callAjax("BrowseByBookTable","type="+e+"&address="+getStorage("search_address")+"&services="+t+"&cuisine_type="+a+"&restaurant_name="+$(".restaurant_name").val()),3==e&&callAjax("searchRestaurant","type="+e+"&address="+getStorage("search_address")+"&services="+t+"&cuisine_type="+a+"&restaurant_name="+$(".restaurant_name").val())}function onsenAlert(e,t){("undefined"==typeof t||null==t||""==t)&&(t=dialog_title_default),ons.notification.alert({message:e,title:t})}function hideAllModal(){setTimeout("loaderSearch.hide()",1),setTimeout("loader.hide()",1),setTimeout("loaderLang.hide()",1)}function callAjax(e,t){return hasConnection()?(dump("action=>"+e),t+="&lang_id="+getStorage("default_lang"),empty(krms_config.APIHasKey)||(t+="&api_key="+krms_config.APIHasKey),dump(ajax_url+"/"+e+"?"+t),void(ajax_request=$.ajax({url:ajax_url+"/"+e,data:t,type:"post",async:!1,dataType:"jsonp",timeout:6e3,crossDomain:!0,beforeSend:function(){if(null!=ajax_request)hideAllModal(),ajax_request.abort();else switch(e){case"registerMobile":break;case"search":loaderSearch.show(),translatePage();break;case"getLanguageSettings":loaderLang.show();break;default:loader.show()}},complete:function(e){ajax_request=null,hideAllModal()},success:function(t){if(dump(t),1==t.code)switch(e){case"search":displayRestaurantResults(t.details.data,"restaurant-results",1),$(".result-msg").text(t.details.total+" "+getTrans("Restaurant found","restaurant_found"));break;case"search_take_away":displayRestaurantResults(t.details.data,"restaurant-results",1),$(".result-msg").text(t.details.total+" "+getTrans("Restaurant found","restaurant_found"));break;case"LoadAddOns":append_addons(t);break;case"MenuCategory":setStorage("merchant_logo",t.details.logo),dump(t.details.restaurant_name),setStorage("merchant_name",t.details.restaurant_name),setStorage("enabled_table_booking",t.details.enabled_table_booking),setStorage("merchant_latitude",t.details.coordinates.latitude),setStorage("merchant_longtitude",t.details.coordinates.longtitude),setStorage("merchant_address",t.details.address),menuCategoryResult(t.details);break;case"cuisineList":cuisineResults(t.details);break;case"cuisineLists":cuisineResult(t.details);break;case"cuisinLists":cuisineReslts(t.details);break;case"getItemByCategory":easy_category_list="",displayItemByCategory(t.details),fillPopOverCategoryList(t.details.category_list);break;case"getItemDetails":displayItem(t.details);break;case"loadCart":$("#page-cart .wrapper").show(),$(".checkout-footer").show(),$("#page-cart .frm-cart").show(),2==t.details.enabled_tip?$(".tip_amount_wrap").show():$(".tip_amount_wrap").hide(),displayCart(t.details),empty(t.details.cart.discount)?removeStorage("has_discount"):setStorage("has_discount",1),"undefined"==typeof addressDialog||null==addressDialog||""==addressDialog||addressDialog.isShown()&&addressDialog.hide();break;case"checkout":if("shipping"==t.details){var a={animation:"slide",onTransitionEnd:function(){if(displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-shipping"),empty(t.msg.profile)||($(".contact_phone").val(t.msg.profile.contact_phone),$(".location_name").val(t.msg.profile.location_name)),empty(getStorage("map_address_result_formatted_address"))){if(!empty(t.msg.address_book)){$(".street").val(t.msg.address_book.street),$(".city").val(t.msg.address_book.city),$(".state").val(t.msg.address_book.state),$(".zipcode").val(t.msg.address_book.zipcode),$(".location_name").val(t.msg.address_book.location_name);var e=t.msg.address_book.street;e+=" "+t.msg.address_book.city,e+=" "+t.msg.address_book.state,e+=" "+t.msg.address_book.zipcode,$(".delivery-address-text").html(e),$(".formatted_address").val(e)}}else $(".delivery-address-text").html(getStorage("map_address_result_formatted_address")),$(".street").val(getStorage("map_address_result_address")),$(".city").val(getStorage("map_address_result_city")),$(".state").val(getStorage("map_address_result_state")),$(".zipcode").val(getStorage("map_address_result_zip")),$(".formatted_address").val(getStorage("map_address_result_formatted_address")),$(".google_lat").val(getStorage("google_lat")),$(".google_lng").val(getStorage("google_lng"))}};sNavigator.pushPage("shipping.html",a)}else if("payment_method"==t.details){var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-paymentoption");var e="merchant_id="+getStorage("merchant_id");e+="&client_token="+getStorage("client_token"),e+="&transaction_type="+$(".transaction_type:checked").val(),callAjax("getPaymentOptions",e)}};sNavigator.pushPage("paymentOption.html",a)}else if("enter_contact_number"==t.details){var a={animation:"slide",onTransitionEnd:function(){initIntelInputs()}};sNavigator.pushPage("enterContact.html",a)}else{var a={animation:"slide",onTransitionEnd:function(){dump(getStorage("merchant_logo")),dump(getStorage("order_total")),displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-checkoutsignup"),callAjax("getCustomFields",""),initIntelInputs()}};sNavigator.pushPage("checkoutSignup.html",a)}break;case"signup":if(setStorage("client_token",t.details.token),setStorage("avatar",t.details.avatar),setStorage("client_name_cookie",t.details.client_name_cookie),"shipping_address"==t.details.next_step){var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-shipping"),fillShippingAddress()}};sNavigator.pushPage("shipping.html",a)}else if("return_home"==t.details.next_step)onsenAlert(t.msg),menu.setMainPage("select_dining.html",{closeMenu:!0});else if("mobile_verification"==t.details.next_step){removeStorage("client_token");var a={animation:"none",onTransitionEnd:function(){$(".mobile-verification-msg").show(),$(".email-verification-msg").hide(),$(".client_id").val(t.details.client_id),$(".is_checkout").val(t.details.is_checkout),$(".validation_type").val(t.details.next_step)}};sNavigator.pushPage("SignupVerification.html",a)}else if("email_verification"==t.details.next_step){removeStorage("client_token");var a={animation:"none",onTransitionEnd:function(){$(".mobile-verification-msg").hide(),$(".email-verification-msg").show(),$(".client_id").val(t.details.client_id),$(".is_checkout").val(t.details.is_checkout),$(".validation_type").val(t.details.next_step)}};sNavigator.pushPage("SignupVerification.html",a)}else{dump("payment_option");var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-paymentoption");var e="merchant_id="+getStorage("merchant_id");callAjax("getPaymentOptions",e)}};sNavigator.pushPage("paymentOption.html",a)}break;case"getPaymentOptions":$(".frm-paymentoption").show(),$(".paypal_flag").val(t.details.paypal_flag),$(".paypal_mode").val(t.details.paypal_credentials.mode),$(".client_id_sandbox").val(t.details.paypal_credentials.client_id_sandbox),$(".client_id_live").val(t.details.paypal_credentials.client_id_live),$(".paypal_card_fee").val(t.details.paypal_credentials.card_fee),$(".citypay_mode").val(t.details.citypay_credentials.mode),$(".citypay_username").val(t.details.citypay_credentials.username),$(".citypay_password").val(t.details.citypay_credentials.password),$(".citypay_fee").val(t.details.citypay_credentials.card_fee),setStorage("citypay_mode",t.details.citypay_credentials.mode),setStorage("citypay_username",t.details.citypay_credentials.username),setStorage("citypay_password",t.details.citypay_credentials.password),setStorage("citypay_fee",t.details.citypay_credentials.card_fee),setStorage("paypal_card_fee",t.details.paypal_credentials.card_fee),"yes"==t.details.voucher_enabled?($(".voucher-wrap").show(),$(".voucher_code").attr("placeholder",getTrans("Enter Voucher here","enter_voucher_here"))):$(".voucher-wrap").hide(),setStorage("stripe_publish_key",t.details.stripe_publish_key),setStorage("stripe_publish_key",t.details.stripe_publish_key),empty(t.details.razorpay)||(setStorage("razor_key_id",t.details.razorpay.razor_key),setStorage("razor_secret_key",t.details.razorpay.razor_secret)),2==getStorage("pts")?(dump("pts is enabled"),$(".redeem_points").attr("placeholder",t.details.pts.pts_label_input),$(".pts_available_points").html(t.details.pts.balance)):$(".pts-apply-points-wrap").hide(),displayPaymentOptions(t);break;case"placeOrder":switch(setStorage("order_id",t.details.order_id),t.details.next_step){case"paypal_init":setStorage("currency_code",t.details.payment_details.currency_code),setStorage("paymet_desc",t.details.payment_details.paymet_desc),setStorage("total_w_tax",t.details.payment_details.total_w_tax),app_paypal.initPaymentUI();break;case"cpy_init":setStorage("currency_code",t.details.payment_details.currency_code),setStorage("paymet_desc",t.details.payment_details.paymet_desc),setStorage("total_w_tax",t.details.payment_details.total_w_tax);var a={animation:"slide",onTransitionEnd:function(){$(".order_id").val(t.details.order_id),$(".currency_code").val(t.details.payment_details.currency_code),$(".paymet_desc").val(t.details.payment_details.paymet_desc),$(".total_w_tax").val(t.details.payment_details.total_w_tax)}};sNavigator.pushPage("cpyPaymentForm.html",a);break;case"atz_init":var a={animation:"slide",onTransitionEnd:function(){$(".order_id").val(t.details.order_id),$(".currency_code").val(t.details.payment_details.currency_code),$(".paymet_desc").val(t.details.payment_details.paymet_desc),$(".total_w_tax").val(t.details.payment_details.total_w_tax)}};sNavigator.pushPage("atzPaymentForm.html",a);break;case"stp_init":var a={animation:"slide",onTransitionEnd:function(){$(".order_id").val(t.details.order_id),$(".currency_code").val(t.details.payment_details.currency_code),$(".paymet_desc").val(t.details.payment_details.paymet_desc),$(".total_w_tax").val(t.details.payment_details.total_w_tax)}};sNavigator.pushPage("stripePaymentForm.html",a);break;case"rzr_init":var o=getStorage("razor_key_id");if(empty(o))return void onsenAlert(getTrans("Key id is empty","key_id_empty"));var r={description:t.details.payment_details.paymet_desc,currency:t.details.payment_details.currency_code,key:o,amount:t.details.payment_details.total_w_tax_times,name:t.details.payment_details.merchant_name,prefill:{email:t.details.payment_details.customer_email,contact:t.details.payment_details.customer_contact,name:t.details.payment_details.customer_name},theme:{color:t.details.payment_details.color}};dump(r),isDebug()?rzr_successCallback("pay_debug_1234566"):RazorpayCheckout.open(r,rzr_successCallback,rzr_cancelCallback);break;default:var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),t.details.payment_details.total_w_tax_pretty,"page-receipt"),$(".receipt-msg").html(t.msg)}};sNavigator.pushPage("receipt.html",a)}break;case"paypalSuccessfullPayment":case"PayAtz":case"Paycpy":case"PayStp":case"razorPaymentSuccessfull":var n=t.details.amount_to_pay;0==n&&(n=getStorage("order_total"));var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),prettyPrice(n),"page-receipt"),$(".receipt-msg").html(t.msg)}};sNavigator.pushPage("receipt.html",a);break;case"getMerchantInfo":showMerchantInfo(t.details);break;case"bookATableNewconcept":$("#frm-booking")[0].reset();var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),"","page-booking-ty"),$(".book-ty-msg").html(t.msg)}};sNavigator.pushPage("bookingTY.html",a);break;case"merchantReviews":displayReviews(t.details);break;case"addReview":onsenAlert(t.msg),sNavigator.popPage({cancelIfRunning:!0}),loadMoreReviews();break;case"browseRestaurant":displayRestaurantResults(t.details.data,"browse-results",3),$(".result-msg").text(t.details.total+" "+getTrans("Restaurant found","restaurant_found"));break;case"BrowseByBookTable":displayRestaurantResults(t.details.data,"restaurant-result",2),$(".result-msg").text(t.details.total+" "+getTrans("Restaurant found","restaurant_found"));break;case"searchRestaurant":displayRestaurantResults(t.details.data,"browse-results",3),$(".result-msg").text(t.details.total+" "+getTrans("Restaurant found","restaurant_found"));break;case"getProfile":$(".first_name").val(t.details.first_name),$(".last_name").val(t.details.last_name),$(".email_address").val(t.details.email_address),$(".contact_phone").val(t.details.contact_phone),$(".avatar").attr("src",t.details.avatar),$("#frm-booking input[name='booking_name']").val(t.details.first_name+" "+t.details.last_name),$("#frm-booking input[name='email']").val(t.details.email_address),$("#frm-booking input[name='mobile']").val(t.details.contact_phone),dump("set avatar"),setStorage("avatar",t.details.avatar),imageLoaded(".img_loaded"),initIntelInputs();break;case"registerUsingFb":case"login":switch(setStorage("client_token",t.details.token),setStorage("client_id",t.details.client_id),setStorage("avatar",t.details.avatar),setStorage("client_name_cookie",t.details.client_name_cookie),t.details.next_steps){case"delivery":var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-shipping"),empty(t.details.contact_phone)||$(".contact_phone").val(t.details.contact_phone),empty(t.details.location_name)||$(".location_name").val(t.details.location_name),empty(getStorage("map_address_result_formatted_address"))?2==t.details.has_addressbook&&($(".delivery-address-text").html(t.details.default_address.address),$(".street").val(t.details.default_address.street),$(".city").val(t.details.default_address.city),$(".state").val(t.details.default_address.state),$(".zipcode").val(t.details.default_address.zipcode),$(".formatted_address").val(t.details.default_address.address)):($(".delivery-address-text").html(getStorage("map_address_result_formatted_address")),$(".street").val(getStorage("map_address_result_address")),$(".city").val(getStorage("map_address_result_city")),$(".state").val(getStorage("map_address_result_state")),$(".zipcode").val(getStorage("map_address_result_zip")),$(".formatted_address").val(getStorage("map_address_result_formatted_address")),$(".google_lat").val(getStorage("google_lat")),$(".google_lng").val(getStorage("google_lng")))}};sNavigator.pushPage("shipping.html",a);break;case"pickup":var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-paymentoption");var e="merchant_id="+getStorage("merchant_id");callAjax("getPaymentOptions",e)}};sNavigator.pushPage("paymentOption.html",a);break;default:menu.setMainPage("select_dining.html",{closeMenu:!0})}break;case"forgotPassword":onsenAlert(t.msg),dialogForgotPass.hide();break;case"getOrderHistory":displayOrderHistory(t.details);break;case"getBookingHistory":displayBookingHistory(t.details);break;case"ordersDetails":displayOrderHistoryDetails(t.details);break;case"getBookingDetails":displayBookingHistoryDetails(t.details);break;case"getAddressBook":displayAddressBook(t.details);break;case"getAddressBookDetails":fillAddressBook(t.details);break;case"saveAddressBook":"add"==t.details?(sNavigator.popPage({cancelIfRunning:!0}),callAjax("getAddressBook","client_token="+getStorage("client_token"))):onsenAlert(t.msg);break;case"deleteAddressBook":sNavigator.popPage({cancelIfRunning:!0}),callAjax("getAddressBook","client_token="+getStorage("client_token"));break;case"getAddressBookDialog":displayAddressBookPopup(t.details);break;case"reOrder":setStorage("merchant_id",t.details.merchant_id),cart=t.details.cart,showCart();break;case"registerMobile":break;case"reverseGeoCoding":$("#s").val(t.details);break;case"getSettings":1==t.details.enabled_push?enabled_push.setChecked(!0):enabled_push.setChecked(!1),$(".country_code_set").val(t.details.country_code_set);var i=getStorage("device_id");$(".device_id_val").html(i);break;case"mobileCountryList":displayLocations(t.details);break;case"getLanguageSelection":displayLanguageSelection(t.details);break;case"getLanguageSettings":setStorage("translation",JSON.stringify(t.details.translation)),dump(t),setStorage("decimal_place",t.details.settings.decimal_place),setStorage("currency_position",t.details.settings.currency_position),setStorage("currency_set",t.details.settings.currency_set),setStorage("thousand_separator",t.details.settings.thousand_separator),setStorage("decimal_separator",t.details.settings.decimal_separator),setStorage("show_addon_description",t.details.settings.show_addon_description);var s=getStorage("default_lang");dump("device_set_lang=>"+s),empty(s)&&(dump("proceed"),empty(t.details.settings.default_lang)?setStorage("default_lang",""):setStorage("default_lang",t.details.settings.default_lang)),setStorage("single_add_item",t.details.settings.single_add_item),setStorage("pts",t.details.settings.pts),setStorage("facebook_flag",t.details.settings.facebook_flag),setStorage("avatar",t.details.settings.avatar),setStorage("client_name_cookie",t.details.settings.client_name_cookie),setStorage("mobile_country_code",t.details.settings.mobile_country_code),setStorage("from_icon",t.details.settings.map_icons.from_icon),setStorage("destination_icon",t.details.settings.map_icons.destination_icon),setStorage("mobile_save_cart_db",t.details.settings.mobile_save_cart_db),translatePage();break;case"applyVoucher":dump(t.details),$(".voucher_amount").val(t.details.amount),$(".voucher_type").val(t.details.voucher_type),$(".apply-voucher").hide(),$(".remove-voucher").css({display:"block"}),$(".voucher-header").html(t.details.less);var l=t.details.new_total;$(".total-amount").html(prettyPrice(l));break;case"validateCLient":if(setStorage("client_token",t.details.token),onsenAlert(t.msg),"shipping_address"==t.details.is_checkout){var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-shipping"),fillShippingAddress()}};sNavigator.pushPage("shipping.html",a)}else if("payment_option"==t.details.is_checkout){var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-paymentoption");var e="merchant_id="+getStorage("merchant_id");callAjax("getPaymentOptions",e)}};sNavigator.pushPage("paymentOption.html",a)}else menu.setMainPage("select_dining.html",{closeMenu:!0});break;case"getPTS":$(".available_points").html(t.details.available_points),$(".expenses_points").html(t.details.total_expenses_points),$(".expired_points").html(t.details.points_expiring);break;case"detailsPTS":$(".pts_title").html(t.details.title),displayPTSdetails(t.details.data);break;case"applyRedeemPoints":$(".pts_redeem_points").val(t.details.pts_points_raw),$(".pts_redeem_amount").val(t.details.pts_amount_raw),$(".pts_points_label").html(t.details.pts_points+" ("+t.details.pts_amount+")"),$(".pts_pts").hide(),$(".pts_pts_cancel").css({display:"block"});var l=t.details.new_total;dump("compute new total for pts"),$(".total-amount").html(prettyPrice(l));break;case"addToCart":toastMsg(getTrans("Item added to cart","item_added_to_cart"));break;case"getCustomFields":var c="";$.each(t.details,function(e,t){c+=customFields(e,t)}),createElement("custom-fields-wrap",c),"yes"==t.msg?$(".iagree-wrap").show():$(".iagree-wrap").hide();break;case"verifyAccount":setStorage("client_token",t.details.token),toastMsg(t.msg),menu.setMainPage("select_dining.html",{closeMenu:!0});break;case"coordinatesToAddress":var d=new plugin.google.maps.LatLng(t.details.lat,t.details.lng),g="";g+=t.details.result.formatted_address,setStorage("map_address_result_address",t.details.result.address),setStorage("map_address_result_city",t.details.result.city),setStorage("map_address_result_state",t.details.result.state),setStorage("map_address_result_zip",t.details.result.zip),setStorage("map_address_result_country",t.details.result.country),setStorage("map_address_result_formatted_address",t.details.result.formatted_address),setStorage("google_lat",t.details.lat),setStorage("google_lng",t.details.lng),map_search.addMarker({position:d,title:g,snippet:getTrans("Press on marker 2 seconds to drag","press_marker"),draggable:!0},function(e){e.showInfoWindow(),1==drag_marker_bounce&&e.setAnimation(plugin.google.maps.Animation.BOUNCE),drag_marker=e,drag_marker_bounce=2,e.addEventListener(plugin.google.maps.event.MARKER_DRAG_END,function(e){e.getPosition(function(t){temp_result=explode(",",t.toUrlValue()),drag_marker=e,callAjax("dragMarker","lat="+temp_result[0]+"&lng="+temp_result[1])})})});break;case"dragMarker":setStorage("map_address_result_address",t.details.result.address),setStorage("map_address_result_city",t.details.result.city),setStorage("map_address_result_state",t.details.result.state),setStorage("map_address_result_zip",t.details.result.zip),setStorage("map_address_result_country",t.details.result.country),setStorage("map_address_result_formatted_address",t.details.result.formatted_address),setStorage("google_lat",t.details.lat),setStorage("google_lng",t.details.lng),drag_marker.setTitle(t.details.result.formatted_address),drag_marker.showInfoWindow();break;case"trackOrderHistory":if($(".track-status-wrap").html(""),$(".time-left").html(t.details.time_left),$(".remaining").html(t.details.remaining),t.details.history.length>0){var p="<ul>";$.each(t.details.history,function(e,t){dump(t),p+="<li>",p+='<div class="s-c-g"></div>',p+="<p>"+t.date_time+"</p>",p+="<h3>"+t.status+"</h3>",p+="</li>"}),p+="</ul>",$(".track-status-wrap").append(p)}1==t.details.assign_driver?($(".track_driver").show(),$(".driver_lat").val(t.details.coordinates.driver_lat),$(".driver_lng").val(t.details.coordinates.driver_lng),$(".task_lat").val(t.details.coordinates.task_lat),$(".task_lng").val(t.details.coordinates.task_lng),$(".driver_name").val(t.details.driver_info.driver_name),$(".driver_email").val(t.details.driver_info.driver_email),$(".driver_phone").val(t.details.driver_info.driver_phone),$(".transport_type").val(t.details.driver_info.transport_type),$(".licence_plate").val(t.details.driver_info.licence_plate),$(".delivery_address").val(t.details.delivery_address),$(".driver_icon").val(t.details.driver_icon),$(".address_icon").val(t.details.address_icon),$(".driver_avatar").val(t.details.driver_avatar)):($(".track_driver").hide(),$(".driver_lat").val(""),$(".driver_lng").val(""),$(".task_lat").val(""),$(".task_lng").val(""),$(".driver_name").val(""),$(".driver_email").val(""),$(".driver_phone").val(""),$(".transport_type").val(""),$(".licence_plate").val(""),$(".delivery_address").val(""),$(".driver_avatar").val("")),stopTrackInterval(),track_order_interval=setInterval(function(){runTrackOrder()},7e3);break;case"saveContactNumber":var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-paymentoption");var e="merchant_id="+getStorage("merchant_id");e+="&client_token="+getStorage("client_token"),callAjax("getPaymentOptions",e)}};sNavigator.pushPage("paymentOption.html",a);break;case"trackOrderMap":reInitTrackMap(t.details);break;case"getMerchantCClist":fillCCList(t.details);break;case"saveCreditCard":case"deleteCreditCard":sNavigator.popPage({cancelIfRunning:!0});var m="merchant_id="+getStorage("merchant_id");m+="&client_token="+getStorage("client_token"),callAjax("getMerchantCClist",m);break;case"loadCC":$(".card_name").val(t.details.card_name),$(".cc_number").val(t.details.credit_card_number),$(".cvv").val(t.details.cvv),$(".billing_address").val(t.details.billing_address),$(".expiration_month").val(t.details.expiration_month),$(".expiration_yr").val(t.details.expiration_yr),$(".expiration_month_label").html(t.details.expiration_month),$(".expiration_year").html(t.details.expiration_yr),$(".cc_id").val(t.details.cc_id),$(".delete-cc").show();break;default:onsenAlert(t.msg)}else switch(dump("failed condition"),e){case"search":$(".result-msg").text(t.msg),createElement("restaurant-results","");break;case"getItemByCategory":onsenAlert(t.msg),displayMerchantInfo(t.details);break;case"loadCart":displayMerchantLogo(t.details,"page-cart"),toastMsg(t.msg),$("#page-cart .wrapper").hide(),$("#page-cart .frm-cart").hide(),$(".checkout-footer").hide(),showCartNosOrder();break;case"getPaymentOptions":3==t.details?(onsenAlert(t.msg),sNavigator.popPage({cancelIfRunning:!0})):($(".frm-paymentoption").hide(),onsenAlert(t.msg));break;case"browseRestaurant":createElement("browse-results",""),$(".result-msg").text(t.msg);break;case"getProfile":dump("show login form"),menu.setMainPage("prelogin.html",{closeMenu:!0});break;case"getAddressBook":createElement("address-book-list",""),3==t.code&&menu.setMainPage("prelogin.html",{closeMenu:!0});break;case"getOrderHistory":3==t.code?menu.setMainPage("prelogin.html",{closeMenu:!0}):toastMsg(t.msg);break;case"registerMobile":case"getLanguageSettings":break;case"getSettings":var i=getStorage("device_id");$(".device_id_val").html(i);break;case"addToCart":case"getCustomFields":break;case"merchantReviews":case"saveContactNumber":case"coordinatesToAddress":case"trackOrderMap":toastMsg(t.msg);break;case"getMerchantCClist":toastMsg(t.msg),$("#cc-list").html("");break;case"trackOrderHistory":case"loadCC":sNavigator.popPage({cancelIfRunning:!0});break;default:onsenAlert(t.msg)}},error:function(t,a){hideAllModal(),"getLanguageSettings"==e||"registerMobile"==e||toastMsg(getTrans("Network error has occurred please try again!","network_error"))}}))):void("registerMobile"!=e&&toastMsg(getTrans("CONNECTION LOST","connection_lost")))}function setHome(){dump("setHome");var e={closeMenu:!0,animation:"slide",callback:setHomeCallback};menu.setMainPage("select_dining.html",e)}function setSubHome(){dump("setHome");var e={closeMenu:!0,animation:"slide",callback:setHomeCallback};"&client_token="+getStorage("client_token");menu.setMainPage("home.html",e)}function setHomeCallback(){refreshConnection()}function displayRestaurantResults(e,t,a){var o="";$.each(e,function(e,t){dump(t);var r="";r="'"+t.logo+"'";var n="";if(n="'"+t.restaurant_name+"'",o+='<ons-list-item modifier="tappable" class="list-item-container product list"  >',o+='<ons-row class="row product-list">',o+='<ons-col class="col-image border">',o+=2==a?'<div class="logo-wrap2" onclick="loadRestaurantCategory('+t.merchant_id+')" >':'<div class="logo-wrap2" onclick="loadRestaurantCategory('+t.merchant_id+');" >',o+='<div class="img_loaded" >',o+='<img src="'+t.logo+'" />',o+="</div>",o+="</div>",o+="</ons-col>",o+='<ons-col class="col-description product-desc border">',o+="<div>",o+=2==a?'<p class="restauran-title concat-text" onclick="loadRestaurantCategory('+t.merchant_id+","+r+","+n+')" >'+t.restaurant_name+"</p>":'<p class="restauran-title concat-text" onclick="loadRestaurantCategory('+t.merchant_id+');" >'+t.restaurant_name+"</p>",o+='<p class="concat-textx type">'+t.cuisine+"</p>",o+='<span class="notification '+t.tag_raw+' ">'+t.is_open+"</span><br>","pre-order"==$.trim(t.is_open)&&setStorage("merchant_is_open",t.is_open),o+='<div class="rating-stars" data-score="'+t.ratings.ratings+'"></div>',dump(t.service),empty(t.service)||(o+="<ul>",$.each(t.services,function(e,t){o+="<li>"+t+' <i class="green-color ion-android-checkmark-circle"></i></li>'}),o+="</ul>"),o+='<p class="cod">'+t.payment_options.cod+"</p>",empty(t.distance)||(o+='<p class="time-tag">'+t.distance+"</p>"),3!=t.service&&(empty(t.delivery_estimation)||(o+="<p>"+t.delivery_estimation+"</p>"),empty(t.delivery_distance)||(o+="<p>"+t.delivery_distance+"</p>")),t.offers.length>0&&$.each(t.offers,function(e,t){}),3==a||1==a)o+='<div class="booking-btn" data="book" onclick="loadRestaurantCategory('+t.merchant_id+","+r+","+n+')" > View Menu </div>';else if("yes"==t.table_booking_option)o+='<div class="booking-btn" data="menu" onclick="loadRestaurantCategory('+t.merchant_id+","+r+","+n+')" > View Menu </div>';else{var i="Book a Table";"Take Away"==$("#search-text").text()&&(i="Take Away"),o+='<div class="booking-btn" onclick="popUpTableBooking(('+t.merchant_id+","+r+","+n+')" > '+i+" </div>";
}o+="</div>",o+="</ons-col>",o+="</ons-row>",o+="</ons-list-item>"}),createElement(t,o),initRating(),imageLoaded(".img_loaded")}function initRating(){$(".rating-stars").raty({readOnly:!0,score:function(){return $(this).attr("data-score")},path:"lib/raty/images"}),translatePage()}function loadRestaurantCategory(e){var t=new Date,a=new Array(7);a[0]="Sunday",a[1]="Monday",a[2]="Tuesday",a[3]="Wednesday",a[4]="Thursday",a[5]="Friday",a[6]="Saturday";var o=a[t.getDay()],r=o.substring(0,3),r=r.toLowerCase();$("#mob_current_timing").val(r),cart=[],removeStorage("tips_percentage"),removeStorage("cc_id"),dump("clear cart");var n={animation:"slide",onTransitionEnd:function(){callAjax("MenuCategory","merchant_id="+e+"&device_id="+getStorage("device_id")+"&current_day="+r)}};setStorage("merchant_id",e),sNavigator.pushPage("menucategory.html",n)}function cuisineResults(e){var t="";t+="<ons-list>",t+='<ons-list-header class="list-header trn" data-trn-key="services">Services</ons-list-header>',t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="delivery_type" class="delivery_type" value="1" >',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=' <span class="trn" data-trn-key="delivery_n_pickup" >Delivery & Pickup</span>',t+="</label>",t+="</ons-list-item>",t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="delivery_type" class="delivery_type" value="2">',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=' <span class="trn" data-trn-key="delivery_only">Delivery Only</span>',t+="</label> ",t+="</ons-list-item>",t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="delivery_type" class="delivery_type" value="3">',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=' <span class="trn" data-trn-key="pickup_only">Pickup Only</span>',t+="</label>  	   ",t+="</ons-list-item>	",t+='<ons-list-header class="list-header trn" data-trn-key="cuisine">Cuisine</ons-list-header>',$.each(e,function(e,a){t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="cuisine_type" class="cuisine_type" value="'+e+'">',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=" "+a,t+="</label>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("filter-option-lists",t),$(".restaurant_name").attr("placeholder",getTrans("Enter Restaurant name","enter_resto_name")),translatePage()}function cuisineReslts(e){var t="";t+="<ons-list>",t+='<ons-list-header class="list-header trn" data-trn-key="services">Services</ons-list-header>',t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="delivery_type" class="delivery_type" value="1" >',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=' <span class="trn" data-trn-key="delivery_n_pickup" >Delivery & Pickup</span>',t+="</label>",t+="</ons-list-item>",t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="delivery_type" class="delivery_type" value="2">',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=' <span class="trn" data-trn-key="delivery_only">Delivery Only</span>',t+="</label> ",t+="</ons-list-item>",t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="delivery_type" class="delivery_type" value="3">',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=' <span class="trn" data-trn-key="pickup_only">Pickup Only</span>',t+="</label>  	   ",t+="</ons-list-item>	",t+='<ons-list-header class="list-header trn" data-trn-key="cuisine">Cuisine</ons-list-header>',$.each(e,function(e,a){t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="cuisine_type" class="cuisine_type" value="'+e+'">',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=" "+a,t+="</label>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("filter-options-lists",t),$(".restaurant_name").attr("placeholder",getTrans("Enter Restaurant name","enter_resto_name")),translatePage()}function cuisineResult(e){var t="";t+="<ons-list>",t+='<ons-list-header class="list-header trn" data-trn-key="cuisine">Cuisine</ons-list-header>',$.each(e,function(e,a){t+='<ons-list-item modifier="tappable">',t+='<label class="checkbox checkbox--list-item">',t+='<input type="checkbox" name="cuisine_type" class="cuisine_type" value="'+e+'">',t+='<div class="checkbox__checkmark checkbox--list-item__checkmark"></div>',t+=" "+a,t+="</label>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("filter-options-list",t),$(".restaurant_name").attr("placeholder",getTrans("Enter Restaurant name","enter_resto_name")),translatePage()}function menuCategoryResult(e){if($("#merchant_open_close_timing").val(e.selected_date),$("#menucategory-page .restauran-title").text(e.restaurant_name),$("#menucategory-page .rating-stars").attr("data-score",e.ratings.ratings),initRating(),$("#menucategory-page .logo-wrap").html('<img src="'+e.logo+'" />'),2==e.enabled_table_booking&&$("#menucategory-page .tbl-book").html('<button id="tbl-booking" class="white-btn" onclick="popUpTableBooking(('+e.merchant_id+",'"+e.logo+"','"+e.restaurant_name+"')\" > Book a Table </button>"),e.open?$("#merchant_open").val(2):$("#merchant_open").val(1),e.merchant_close_store?$("#close_store").val(2):$("#close_store").val(1),!e.menu_category)return void onsenAlert(getTrans("Error: Restaurant has no menu","Restaurant has no menu"));var t="",a=[],o=1;t+='<ons-list><div class="swiper-container"><div class="swiper-wrapper">',$.each(e.menu_category,function(e,r){a.push(r.cat_id);var n="";1==o&&(n="active"),t+='<div class="swiper-slide '+n+'"  ><a href="javascript:;" data-scroll="scroll_div_'+r.cat_id+'" onclick="scroll_list('+r.cat_id+',this)"  > '+r.category_name+"</a></div>",o=parseInt(o)+1}),t+='</div></div><div class="swiper-pagination"></div></ons-list>',createElement("category-list",t);var r=(new Swiper(".swiper-container",{pagination:".swiper-pagination",slidesPerView:"auto",paginationClickable:!0,spaceBetween:15}),"");r+='<ons-list class="restaurant-list">';var n=[],o=0,i=1;$.each(e.item,function(t,a){var s='style = "display:none;"';if(-1!==$.inArray(a.category_id,n)||(n.push(a.category_id),o>0&&(r+="</div>"),1==i&&(s='style = "display:block;"'),r+='<div id = "scroll_div_'+a.category_id+'"  '+s+'   data-anchor="scroll_div_'+a.category_id+'" class="scrolling-div" >  <div class="category-heading" >'+a.category_name+"</div>",o=parseInt(o)+1,i=parseInt(i)+1),2==e.disabled_ordering)r+='<ons-list-item modifier="tappable" class="list-item-container" onclick="itemNotAvailable(2)" >';else if(2==a.not_available)r+='<ons-list-item modifier="tappable" class="list-item-container" onclick="itemNotAvailable(1)" >';else{var l=getStorage("single_add_item");dump("=>"+l),2==a.single_item&&2==l?(item_auto_price="0|",item_auto_discount="0",a.prices.length>0&&$.each(a.prices,function(e,t){empty(t.price_discount_pretty)?item_auto_price="'"+t.price+"|'":(item_auto_price="'"+t.price+"|'",item_auto_discount=parseInt(t.price)-parseInt(t.price_discount))}),r+='<ons-list-item modifier="tappable" class="list-item-container" onclick="autoAddToCart('+a.item_id+","+item_auto_price+","+item_auto_discount+');"  >'):r+='<ons-list-item modifier="tappable" class="list-item-container" onclick="loadItemDetails('+a.item_id+","+e.merchant_info.merchant_id+","+e.category_info.cat_id+');"  >'}r+='<ons-row class="row">',r+='<ons-col class="col-image food-img" width="35%">',r+='<div class="logo-wrap2" >',r+='<div class="img_loaded" >',r+='<img src="'+a.photo+'" />',r+="</div>",r+="</div>",r+="</ons-col>",r+='<ons-col class="col-description food-desc" width="65%">',r+='<p class="restauran-title concat-text">'+a.item_name+"</p>",r+='<p class="concat-text">'+a.item_description+"</p>",a.prices.length>0&&$.each(a.prices,function(e,t){var a="";"standard"!=t.size&&(a=t.size),empty(t.price_discount_pretty)?r+='<p class="p-small">'+a+" <price>"+t.price_pretty+"</price></p>":(r+='<p class="p-small">'+a+' <price class="discount">'+t.price_pretty+"</price>",r+="<price>"+t.price_discount_pretty+"</price>",r+="</p>")}),r+='<img height="20" src="'+a.category_img_url+'">',2==a.not_available&&(r+="<p>item not available</p>"),r+="</ons-col>",r+="</ons-row>",r+="</ons-list-item>"}),r+="</ons-list>",createElement("menu-list",r),imageLoaded(".img_loaded")}function loadmenu(e,t){var a={animation:"none",onTransitionEnd:function(){callAjax("getItemByCategory","cat_id="+e+"&merchant_id="+t),showCartNosOrder()}};sNavigator.pushPage("menuItem.html",a)}function scroll_list(e,t){$(".swiper-slide").removeClass("active"),$(t).parent().addClass("active"),$(".scrolling-div").css("display","none"),$("#scroll_div_"+e).css("display","block")}function displayMerchantInfo(e){empty(e)||($("#page-menubycategoryitem #search-text").html(e.category_info.category_name),$("#page-menubycategoryitem .restauran-title").text(e.merchant_info.restaurant_name),$("#page-menubycategoryitem .rating-stars").attr("data-score",e.merchant_info.ratings.ratings),initRating(),$("#page-menubycategoryitem .logo-wrap").html('<img src="'+e.merchant_info.logo+'" />'))}function displayMerchantLogo(e,t){empty(e.merchant_info)||$("#"+t+" .logo-wrap").html('<img src="'+e.merchant_info.logo+'" />'),empty(e.cart_total)||$("#"+t+" .total-amount").html(e.cart_total)}function displayMerchantLogo2(e,t,a){empty(e)||$("#"+a+" .logo-wrap").html('<img src="'+e+'" />'),empty(t)||$("#"+a+" .total-amount").html(t);var o=getStorage("merchant_name");empty(o)||$("#"+a+" .restauran-title").html(o)}function displayItemByCategory(e){dump("mobile_menu=>"+e.mobile_menu),$("#page-menubycategoryitem #search-text").html(e.category_info.category_name),$("#page-menubycategoryitem .restauran-title").text(e.merchant_info.restaurant_name),$("#page-menubycategoryitem .rating-stars").attr("data-score",e.merchant_info.ratings.ratings),initRating(),$("#page-menubycategoryitem .logo-wrap").html('<img src="'+e.merchant_info.logo+'" />');var t="";t+='<ons-list class="restaurant-list">',$.each(e.item,function(a,o){if(2==e.disabled_ordering)t+='<ons-list-item modifier="tappable" class="list-item-container" onclick="itemNotAvailable(2)" >';else if(2==o.not_available)t+='<ons-list-item modifier="tappable" class="list-item-container" onclick="itemNotAvailable(1)" >';else{var r=getStorage("single_add_item");dump("=>"+r),2==o.single_item&&2==r?(item_auto_price="0|",item_auto_discount="0",o.prices.length>0&&$.each(o.prices,function(e,t){empty(t.price_discount_pretty)?item_auto_price=t.price+"|":(item_auto_price=t.price+"|",item_auto_discount=parseInt(t.price)-parseInt(t.price_discount))}),t+='<ons-list-item modifier="tappable" class="list-item-container"',t+="onclick=\"autoAddToCart('"+o.item_id+"','"+item_auto_price+"','"+item_auto_discount+"');\"  >"):t+='<ons-list-item modifier="tappable" class="list-item-container" onclick="loadItemDetails('+o.item_id+","+e.merchant_info.merchant_id+","+e.category_info.cat_id+');"  >'}t+='<ons-row class="row">',1==e.mobile_menu?(t+='<ons-col class="col-image" width="65%">',t+='<p class="restauran-title concat-text">'+o.item_name+"</p>",t+='<p class="">'+o.item_description+"</p>",t+="</ons-col>",t+='<ons-col class="col-image text-right" width="35%">',o.prices.length>0&&$.each(o.prices,function(e,a){empty(a.price_discount_pretty)||(t+='<p class="p-small"> <price class="discount">'+a.price_pretty+"</price>",t+="<price>"+a.price_discount_pretty+"</price>",t+="</p>"),t+='<p class="p-small"> <price>'+a.price_pretty+"</price></p>"}),t+="</ons-col>"):(t+='<ons-col class="col-image" width="35%">',t+='<div class="logo-wrap2" >',t+='<div class="img_loaded" >',t+='<img src="'+o.photo+'" />',t+="</div>",t+="</div>",t+="</ons-col>",t+='<ons-col class="col-description" width="65%">',t+='<p class="restauran-title concat-text">'+o.item_name+"</p>",t+='<p class="concat-text">'+o.item_description+"</p>",o.prices.length>0&&$.each(o.prices,function(e,a){empty(a.price_discount_pretty)?t+='<p class="p-small"> <price>'+a.price_pretty+"</price></p>":(t+='<p class="p-small"> <price class="discount">'+a.price_pretty+"</price>",t+="<price>"+a.price_discount_pretty+"</price>",t+="</p>")}),2==o.not_available&&(t+="<p>item not available</p>"),t+="</ons-col>"),t+="</ons-row>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("menu-list",t),imageLoaded(".img_loaded")}function empty(e){return"undefined"==typeof e||null==e||""==e?!0:!1}function loadItemDetails(e,t,a){if(2==$("#close_store").val()||1==$("#merchant_open").val())return void onsenAlert(getTrans("This Restaurant Is Closed Now.  Please Check The Opening Times","restaurant_close"));var o={animation:"slide",onTransitionEnd:function(){callAjax("getItemDetails","item_id="+e+"&merchant_id="+t+"&cat_id="+a)}};sNavigator.pushPage("itemDisplay.html",o)}function displayItem(e){$("#page-itemdisplay .item-header").css({"background-image":"url("+e.photo+")"}),$("#page-itemdisplay .title").text(e.item_name),$("#page-itemdisplay .description").text(e.item_description),empty(e.category_info)||$("#page-itemdisplay #search-text").text(e.category_info.category_name);var t="";if(t+='<input type="hidden" name="item_id" class="item_id" value="'+e.item_id+'">',t+='<input type="hidden" name="currency_symbol" class="currency_symbol" value="'+e.currency_symbol+'">',t+='<input type="hidden" name="discount" class="discount discount_amt" value="'+e.discount+'">',t+='<input type="hidden" name="two_flavors" class="two_flavors" value="'+e.two_flavors+'">',2==e.two_flavors&&(e.has_price=1),2==e.has_price){t+='<ons-list-header class="list-header trn" data-trn-key="price">Price</ons-list-header>';var a=0;$.each(e.prices,function(o,r){if(e.discount>0){var n='<price class="discount">'+r.pretty_price;n+="</price>",n+="<price>"+r.discounted_price_pretty+"</price>",t+=0==a?privatePriceRowWithRadio2("price",r.price+"|"+r.size.replace('"',"__"),r.size,n,'checked="checked"'):privatePriceRowWithRadio2("price",r.price+"|"+r.size.replace('"',"__"),r.size,n)}else t+=0==a?privatePriceRowWithRadio("price",r.price+"|"+r.size.replace('"',"__"),r.size,r.pretty_price,'checked="checked"'):privatePriceRowWithRadio("price",r.price+"|"+r.size.replace('"',"__"),r.size,r.pretty_price);a++})}t+='<ons-list-header class="list-header">Click here to show Addons <button  class="button button--quiet get_addons"><ons-icon icon="fa-caret-square-o-down" class="icon-green ons-icon fa-caret-square-o-down fa fa-lg"></ons-icon></button> </ons-list-header>',t+='<ons-list id="append_addons">   </ons-list>',empty(e.cooking_ref)||(t+='<ons-list-header class="list-header trn" data-trn-key="cooking_ref">Cooking Preference</ons-list-header>',$.each(e.cooking_ref,function(e,a){t+=privateRowWithRadio("cooking_ref",a,a)})),empty(e.ingredients)||(t+='<ons-list-header class="list-header trn" data-trn-key="ingredients">Ingredients</ons-list-header>',$.each(e.ingredients,function(e,a){t+=privateRowWithCheckbox("ingredients","ingredients",a,a)}));getStorage("show_addon_description");t+=cartFooter(e.currency_code),createElement("item-info",t),setCartValue(),translatePage()}function append_addons(e){if(t="",e.details){var t="";$.each(e.details,function(e,a){t+='<ons-list-header class="list-header require_addon_'+a.subcat_id+' ">'+a.subcat_name+"</ons-list-header>",t+='<input type="hidden" name="require_addon_'+a.subcat_id+'" class="require_addon" value="'+a.require_addons+'" data-id="'+a.subcat_id+'" data-name="'+a.subcat_name+'" >',empty(a.sub_item)||$.each(a.sub_item,function(e,o){t+="custom"==a.multi_option?subItemRowWithCheckbox(a.subcat_id,"sub_item",o.sub_item_id+"|"+o.price+"|"+o.sub_item_name,o.sub_item_name,o.pretty_price,a.multi_option_val,o.item_description):"multiple"==a.multi_option?subItemRowWithCheckboxQty(a.subcat_id,"sub_item",o.sub_item_id+"|"+o.price+"|"+o.sub_item_name,o.sub_item_name,o.pretty_price):subItemRowWithRadio(a.subcat_id,"sub_item",o.sub_item_id+"|"+o.price+"|"+o.sub_item_name+"|"+a.two_flavor_position,o.sub_item_name,o.pretty_price,!1,o.item_description)})})}$("#append_addons").html(createElement("append_addons",t)),$("#append_addons").css("display","block")}function setCartValue(){var e=parseFloat($(".price:checked").val()),t=parseFloat($(".discount_amt").val());isNaN(t)&&(t=0),isNaN(e)&&(e=0),dump("discount=>"+t),dump("selected_price=>"+e);var a=parseFloat($(".qty").val()),o=a*(e-t);dump("addon totalx");var r=0,n=[];$("#page-itemdisplay .sub_item:checkbox:checked").each(function(){var e=explode("|",$(this).val());if(2==$(this).data("withqty")){var t=$(this).parent().parent().parent(),o=parseFloat(t.find(".subitem-qty").val());r+=o*parseFloat(e[1])}else r+=a*parseFloat(e[1])}),$("#page-itemdisplay .sub_item:radio:checked").each(function(){var e=explode("|",$(this).val());dump(e),dump(e[1]),r+=a*parseFloat(e[1]),n.push(parseFloat(e[1]))}),o+=r,dump("total_value =>"+o),2==$(".two_flavors").val()&&(dump("two_flavors"),dump(n),o=Math.max.apply(Math,n),dump("get the highest value => "+o),o=parseInt($("#page-itemdisplay .qty").val())*o),$(".total_value").html(prettyPrice(o))}function addCartQty(e){var t=parseInt($("#page-itemdisplay .qty").val());2==e?t+=1:t-=1,t>1?$("#page-itemdisplay .qty").val(t):$("#page-itemdisplay .qty").val(1),setCartValue()}function addToCart(){var e=!0;if($(".require_addon").exists()&&($(".small-red-text").remove(),$(".require_addon").each(function(){if(2==$(this).val()){var t=$(this).data("id"),a=$(this).data("name"),o=$(".sub_item_name_"+t+":checked").length;if(0>=o){e=!1;var r="You must select at least one addon - "+a;$(".require_addon_"+t).after('<span class="small-red-text">'+r+"</span"),onsenAlert(r)}}})),dump("proceed=>"+e),e){var t=[],a=[],o=[],r="",n=0,i=0,s="",l="",c=$("#page-itemdisplay .frm-foodorder").serializeArray();if(!empty(c)){if($.each(c,function(e,t){"item_id"==t.name&&(r=t.value),"qty"==t.name&&(n=t.value),"price"==t.name&&(i=t.value),"cooking_ref"==t.name&&(a[a.length]={value:t.value}),"ingredients"==t.name&&(o[o.length]={value:t.value}),"order_notes"==t.name&&(s=t.value),"discount"==t.name&&(l=t.value)}),2==$(".two_flavors").val()){var d=$(".sub_item:checked").length;if(2>d)return void onsenAlert(getTrans("You must select price for left and right flavor","two_flavor_required"));var g=0,p=[];$.each($(".sub_item:checked"),function(e,a){var o=$(this).parent().parent().parent(),r=o.find(".subitem-qty").val();empty(r)&&(r="itemqty");var n=$(this).data("id"),i=$(this).val();i=i.split("|"),p[g]=i[1],t[t.length]={subcat_id:n,value:$(this).val(),qty:r},g++}),dump(p),largest=Math.max.apply(Math,p),dump("largest price => "+largest),i=largest}else $.each($(".sub_item:checked"),function(e,a){var o=$(this).parent().parent().parent(),r=o.find(".subitem-qty").val();empty(r)&&(r="itemqty");var n=$(this).data("id");t[t.length]={subcat_id:n,value:$(this).val(),qty:r}});cart[cart.length]={item_id:r,qty:n,price:i,sub_item:t,cooking_ref:a,ingredients:o,order_notes:s,discount:l};var m={item_id:r,qty:n,price:i,sub_item:t,cooking_ref:a,ingredients:o,order_notes:s,discount:l};saveCartToDb()?(callAjax("addToCart","cart="+JSON.stringify(m)+"&device_id="+getStorage("device_id")),sNavigator.popPage({cancelIfRunning:!0})):(sNavigator.popPage({cancelIfRunning:!0}),toastMsg(getTrans("Item added to cart","item_added_to_cart"))),showCartNosOrder()}}}function showCart(){dump("showCart");var e=$(".cart-num").html();if(""==e||"0"==e)sNavigator.pushPage("cartempty.html",t);else{var t={animation:"none",onTransitionEnd:function(){var e=JSON.stringify(cart);if(saveCartToDb())var e="";empty(getStorage("tips_percentage"))&&setStorage("tips_percentage",0),callAjax("loadCart","merchant_id="+getStorage("merchant_id")+"&search_address="+encodeURIComponent(getStorage("search_address"))+"&cart="+e+"&transaction_type="+getStorage("transaction_type")+"&device_id="+getStorage("device_id")+"&tips_percentage="+getStorage("tips_percentage"))}};sNavigator.pushPage("cart.html",t)}}function showCartNosOrder(){$(".cart-num, .carticon").removeClass("animate"),dump("showCartNosOrder"),dump(cart.length),cart.length>0?($(".cart-num").css({display:"inline-block",position:"absolute","margin-left":"-10px"}),$(".cart-num").text(cart.length),setTimeout(function(){$(".cart-num, .carticon").addClass("animate")},100)):$(".cart-num").hide(),$("#flash_msg").show(),setTimeout(function(){$(".cart-num, .carticon").removeClass("animate")},500),setTimeout(function(){$(".cart-num, .carticon").removeClass("animate")},1e3),setTimeout(function(){$("#flash_msg").hide(),$(".cart-num, .carticon").addClass("animate")},2e3)}function ConvertTimeformat(e,t){var a=t,o=Number(a.match(/^(\d+)/)[1]),r=Number(a.match(/:(\d+)/)[1]),n=a.match(/\s(.*)$/)[1];"PM"==n&&12>o&&(o+=12),"PM"==n&&12==o&&(o=o),"PM"==n&&o>12&&(o-=12);var i=o.toString(),s=r.toString();10>o&&(i="0"+i),10>r&&(s="0"+s),$(".delivery_time").val(i+":"+s)}function check_date_time(){var e=$.trim($("#merchant_open_close_timing").val());if(""!=e){var t=e.split(","),a=moment().tz("Europe/Jersey").format("MM/DD/YYYY"),o=moment().tz("Europe/Jersey").format("hh:mm"),r=new Date,n=r.getMonth()+1,i=r.getDate(),s=((""+n).length<2?"0":"")+n+"/"+((""+i).length<2?"0":"")+i+"/"+r.getFullYear(),l=(("0"+r.getMinutes()).slice(-2),new Date(s+" "+d)),c=new Date(a+" "+o),d=o;if(""!=t[0]){var g=t[0].split("-"),c=new Date(a+" "+o),l=c,p=new Date(s+" "+g[0]),m=new Date(s+" "+g[1]);if(p>=l){var u=Date.parse(g[0],"hh:mm tt"),_=u.addMinutes(45),h=_.getHours(),v=_.getMinutes(),f="AM";return h>12&&(h-=12,f="PM"),12==h&&(h=12,f="PM"),10>h&&(h="0"+h),10>v&&(v="0"+v),void ConvertTimeformat("24",h+":"+v+" "+f)}if(l>=p&&m>=l){var y=Date.parse(d,"hh:mm tt"),u=Date.parse(d,"hh:mm tt"),b=y.addMinutes(45);if(b>m)var _=u.addMinutes(0);else var _=u.addMinutes(50);var h=_.getHours(),v=_.getMinutes(),f="AM";return h>12&&(h-=12,f="PM"),12==h&&(h=12,f="PM"),10>h&&(h="0"+h),10>v&&(v="0"+v),void ConvertTimeformat("24",h+":"+v+" "+f)}}if(""!=t[1]){var g=t[1].split("-"),l=new Date(s+" "+d),p=new Date(s+" "+g[0]),m=new Date(s+" "+g[1]);if(p>l){var u=Date.parse(g[0],"hh:mm tt"),_=u.addMinutes(45),h=_.getHours(),v=_.getMinutes(),f="AM";return h>12&&(h-=12,f="PM"),12==h&&(h=12,f="PM"),10>h&&(h="0"+h),10>v&&(v="0"+v),void ConvertTimeformat("24",h+":"+v+" "+f)}if(l>=p&&m>=l){var y=Date.parse(d,"hh:mm tt"),u=Date.parse(d,"hh:mm tt"),b=y.addMinutes(50);if(b>m)var _=u.addMinutes(0);else var _=u.addMinutes(45);var h=_.getHours(),v=_.getMinutes(),f="AM";return h>12&&(h-=12,f="PM"),12==h&&(h=12,f="PM"),10>h&&(h="0"+h),10>v&&(v="0"+v),void ConvertTimeformat("24",h+":"+v+" "+f)}}}}function displayCart(e){var t=(new Date,moment().tz("Europe/Jersey").add("m",45).format("hh:mm A"));$(".delivery_time").val(t),check_date_time(),displayMerchantLogo(e,"page-cart");var a="";if(a+='<input type="hidden" name="validation_msg" class="validation_msg" value="'+e.validation_msg+'">',a+='<input type="hidden" name="required_time" class="required_time" value="'+e.required_time+'">',setStorage("merchant_logo",e.merchant_info.logo),setStorage("order_total",e.cart.grand_total.amount_pretty),setStorage("order_total_raw",e.cart.grand_total.amount),setStorage("cart_currency_symbol",e.currency_symbol),setStorage("cart_sub_total",e.cart.sub_total.amount),empty(e.cart.delivery_charges)||setStorage("cart_delivery_charges",e.cart.delivery_charges.amount),empty(e.cart.packaging)||setStorage("cart_packaging",e.cart.packaging.amount),empty(e.cart.tax)||setStorage("cart_tax",e.cart.tax.tax),empty(e.delivery_date)||$(".delivery_date").val(e.delivery_date),empty(e.delivery_time)||$(".delivery_time").val(e.delivery_time),!empty(e.cart)){empty(e.cart.grand_total.amount_pretty)||$(".total-amount").html(e.cart.grand_total.amount_pretty);var o=1;$.each(e.cart.cart,function(e,t){if(a+=t.discount>0?tplCartRowNoBorder(t.item_id,t.item_name,t.price+"|"+t.size,t.total_pretty,t.qty,"price",t.size,o,t.discounted_price,t.discount):tplCartRowNoBorder(t.item_id,t.item_name,t.price+"|"+t.size,t.total_pretty,t.qty,"price",t.size,o,t.price,t.discount),empty(t.order_notes)||(a+=tplCartRowHiddenFields(t.order_notes,t.order_notes,"order_notes",o,"row-no-border")),empty(t.cooking_ref)||(a+=tplCartRowHiddenFields(t.cooking_ref,t.cooking_ref,"cooking_ref",o,"row-no-border")),empty(t.ingredients)||(a+='<ons-list-header class="subitem-row'+o+'">Ingredients</ons-list-header>',$.each(t.ingredients,function(e,t){a+=tplCartRowHiddenFields(t,t,"ingredients",o,"row-no-border")})),!empty(t.sub_item)){var r=0;$.each(t.sub_item,function(e,n){a+='<ons-list-header class="subitem-row'+o+'">'+e+"</ons-list-header>",$.each(n,function(e,n){dump(n),"itemqty"==n.qty?subitem_qty=t.qty:subitem_qty=n.qty,a+=tplCartRowNoBorderSub(n.subcat_id,n.sub_item_id,n.sub_item_name,n.price,n.total_pretty,subitem_qty,n.qty,o),r++})})}a+='<ons-list-item class="grey-border-top line-separator"></ons-list-item>',o++}),a+='<ons-list-item class="line-separator"></ons-list-item>',empty(e.cart.discount)||(a+=tplCartRow(e.cart.discount.display,"("+e.cart.discount.amount_pretty+")","price-normal")),empty(e.cart.sub_total)||(a+=tplCartRow(getTrans("Sub Total","sub_total"),e.cart.sub_total.amount_pretty,"price-normal")),empty(e.cart.delivery_charges)||(a+=tplCartRow(getTrans("Delivery Fee","delivery_fee"),e.cart.delivery_charges.amount_pretty,"price-normal")),empty(e.cart.packaging)||(a+=tplCartRow(getTrans("Packaging","packaging"),e.cart.packaging.amount_pretty,"price-normal")),empty(e.cart.tax)||(a+=tplCartRow(e.cart.tax.tax_pretty,e.cart.tax.amount,"price-normal")),empty(e.cart.tips)?($(".tip_amount").addClass("trn"),$(".tip_amount").html(getTrans("Tip Amount","tip_amount"))):(a+=tplCartRow(e.cart.tips.tips_percentage_pretty,e.cart.tips.tips_pretty,"price-normal"),$(".tip_amount").removeClass("trn"),$(".tip_amount").html(e.cart.tips.tips_percentage_pretty)),empty(e.cart.grand_total)||(a+=tplCartRow('<b class="trn" data-trn-key="total">Total</b>',e.cart.grand_total.amount_pretty))}var r=getStorage("transaction_type");switch(empty(r)&&(r="delivery"),dump("transaction_type=>"+r),setStorage("transaction_type",r),a+='<ons-list-header class="trn" data-trn-key="delivery_options">Delivery Options</ons-list-header>',dump("services =>"+e.merchant_info.service),e.merchant_info.service){case 2:case"2":a+=privateRowWithRadio("transaction_type","delivery",getTrans("Delivery","delivery"));break;case 3:case"3":r="pickup",setStorage("transaction_type",r),a+=privateRowWithRadio("transaction_type","pickup",getTrans("Pickup","pickup"));break;default:a+=privateRowWithRadio("transaction_type","delivery",getTrans("Delivery","delivery")),a+=privateRowWithRadio("transaction_type","pickup",getTrans("Pickup","pickup"))}createElement("cart-item",a),$.each($(".transaction_type"),function(){$(this).val()==r&&$(this).attr("checked",!0)}),"delivery"==r?($(".delivery_time").attr("placeholder",getTrans("Delivery Time","delivery_time")),$(".delivery_asap_wrap").show()):($(".delivery_time").attr("placeholder",getTrans("Pickup Time","pickup_time")),$(".delivery_asap_wrap").hide()),2==e.has_pts?(setStorage("earned_points",e.points),$(".pts_earn_label").show(),$(".pts_earn_label").html(e.points_label)):($(".pts_earn_label").hide(),removeStorage("earned_points")),initMobileScroller(),translatePage()}function formatAMPM(e){var t=e.getHours(),a=e.getMinutes(),o=t>=12?"pm":"am";t%=12,t=t?t:12,a=10>a?"0"+a:a;var r=t+":"+a+" "+o;return r}function editOrderInit(){$("#page-cart .numeric_only").show(),$(".order-apply-changes").show(),$(".edit-order").hide(),$(".qty-label").hide(),$(".row-del-wrap").show();var e=1;$.each($(".item-qty"),function(t,a){$.each($(".subitem-qty"+e),function(e,t){"itemqty"!=$(this).data("qty")&&$(this).show()}),e++})}function applyCartChanges(){if($("#page-cart .numeric_only").hide(),$(".order-apply-changes").hide(),$(".edit-order").show(),$(".qty-label").show(),$(".subitem-qty").hide(),$(".row-del-wrap").hide(),dump("qty L=>"+$(".item-qty").length),!empty($(".item-qty"))){cart=[];$.each($(".item-qty"),function(e,t){var a=$(this).data("rowid");dump("rowid=>"+a);var o=[],r=[],n=[],i="";$(".ingredients"+a).exists()&&(r[r.length]={value:$(".ingredients"+a).val()}),$(".cooking_ref"+a).exists()&&(n[n.length]={value:$(".cooking_ref"+a).val()}),$(".order_notes"+a).exists()&&(i=$(".order_notes"+a).val()),$.each($(".subitem-qty"+a),function(e,t){subqty=$(this).data("qty"),"itemqty"!=$(this).data("qty")&&(subqty=$(this).val());var a=$(this).parent().parent(),r=a.find(".subcat_id").val(),n=a.find(".sub_item_id").val()+"|"+a.find(".sub_item_price").val()+"|"+a.find(".sub_item_name").val();o[o.length]={qty:subqty,subcat_id:r,value:n}}),cart[cart.length]={item_id:$(".item_id"+a).val(),qty:$(this).val(),price:$(".price"+a).val(),sub_item:o,cooking_ref:n,ingredients:r,order_notes:i,discount:$(".discount"+a).val()},a++}),dump("updated cartx"),dump(cart);var e=JSON.stringify(cart),t="&delivery_date="+$(".delivery_date").val();empty($(".delivery_time").val())||(t+="&delivery_time="+$(".delivery_time").val()),empty(getStorage("tips_percentage"))&&setStorage("tips_percentage",0),callAjax("loadCart","merchant_id="+getStorage("merchant_id")+"&search_address="+encodeURIComponent(getStorage("search_address"))+"&update_cart="+encodeURIComponent(e)+"&transaction_type="+getStorage("transaction_type")+t+"&device_id="+getStorage("device_id")+"&tips_percentage="+getStorage("tips_percentage"))}}function checkOut(){var e=$(".validation_msg").val();if(dump(e),dump(cart),cart.length<1)return void onsenAlert(getTrans("Your cart is empty","your_cart_is_empty"));if(""!=e)return dump("d2"),void onsenAlert(e);var t=$(".transaction_type:checked").val();if(dump("tr_type=>"+t),"pickup"==t&&""==$(".delivery_time").val())return void onsenAlert(getTrans("Pickup time is required","pickup_time_is_required"));if(2==$(".required_time").val()&&""==$(".delivery_time").val()&&$(".delivery_asap:checked").length<=0)return void onsenAlert(t+" "+getTrans("time is required","time_is_required"));var a="&delivery_date="+$(".delivery_date").val();empty($(".delivery_time").val())||(a+="&delivery_time="+$(".delivery_time").val()),a+="&delivery_asap="+$(".delivery_asap:checked").val(),a+="&client_token="+getStorage("client_token"),a+="&merchant_is_open="+getStorage("merchant_is_open"),callAjax("checkout","merchant_id="+getStorage("merchant_id")+"&search_address="+encodeURIComponent(getStorage("search_address"))+"&transaction_type="+getStorage("transaction_type")+a)}function clientRegistration(){$.validate({form:"#frm-checkoutsignup",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){if($(".iagree-wrap").is(":visible")){var e=$(".iagree:checked").val();if(empty(e))return void onsenAlert(getTrans("You must agree to terms & conditions","agree_terms"))}setStorage("customer_contact_number",$(".contact_phone").val());var t=$("#frm-checkoutsignup").serialize();return t+="&transaction_type="+getStorage("transaction_type"),t+="&device_id="+getStorage("device_id"),callAjax("signup",t),!1}})}function clientShipping(){return empty($(".city").val())?void onsenAlert(getTrans("Delivery address is required","delivery_address_required")):void $.validate({form:"#frm-shipping",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-shipping").serialize();setStorage("shipping_address",e),dump(e);var t={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),getStorage("order_total"),"page-paymentoption");var e="merchant_id="+getStorage("merchant_id");e+="&street="+$(".street").val(),e+="&city="+$(".city").val(),e+="&state="+$(".state").val(),
e+="&zipcode="+$(".zipcode").val(),e+="&location_name="+$(".location_name").val(),e+="&save_address="+$(".save_address:checked").val(),e+="&transaction_type="+getStorage("transaction_type"),e+="&client_token="+getStorage("client_token"),callAjax("getPaymentOptions",e)}};return sNavigator.pushPage("paymentOption.html",t),!1}})}function displayPaymentOptions(e){var t="";$.each($(e.details.payment_list),function(e,a){dump(a),t+=tplPaymentList("payment_list",a.value,a.label,a.icon)}),createElement("payment-list",t);var t="";1==e.details.pay_on_delivery_flag&&($.each($(e.details.pay_on_delivery_list),function(e,a){dump(a),t+=tplPaymentProvider("payment_provider_name",a.payment_name,a.payment_name,a.payment_logo)}),createElement("payon-deliver-list",t))}function placeOrder(){if($(".payment_list:checked").length>0){var e=$(".payment_list:checked").val();if(dump(e),"pyr"==e&&(dump($(".payment_provider_name:checked").length),$(".payment_provider_name:checked").length<=0))return void onsenAlert(getTrans("Please select payment provider","please_select_payment_provider"));if("ocr"==e&&empty(getStorage("cc_id")))return void onsenAlert(getTrans("Please select credit card","please_select_cc"));var t=$("#frm-paymentoption").serialize(),a=JSON.stringify(cart);saveCartToDb()&&(a="");var o="&delivery_date="+$(".delivery_date").val();empty($(".delivery_time").val())||(o+="&delivery_time="+$(".delivery_time").val()),o+="&delivery_asap="+$(".delivery_asap:checked").val(),o+="&formatted_address="+$(".formatted_address").val(),o+="&google_lat="+$(".google_lat").val(),o+="&google_lng="+$(".google_lng").val(),o+="&"+getStorage("shipping_address"),o+="&client_token="+getStorage("client_token"),o+="&search_address="+urlencode(getStorage("search_address")),o+="&earned_points="+getStorage("earned_points"),o+="&device_id="+getStorage("device_id"),o+="&"+t,o+="&citypay_mode="+getStorage("citypay_mode"),o+="&citypay_username="+getStorage("citypay_username"),o+="&citypay_password"+getStorage("citypay_password"),o+="&citypay_fee"+getStorage("citypay_fee"),empty(getStorage("tips_percentage"))&&setStorage("tips_percentage",0),o+="&tips_percentage="+getStorage("tips_percentage"),"ocr"==e&&(o+="&cc_id="+getStorage("cc_id")),callAjax("placeOrder","merchant_id="+getStorage("merchant_id")+"&cart="+urlencode(a)+"&transaction_type="+getStorage("transaction_type")+o)}else onsenAlert(getTrans("Please select payment method","please_select_payment_method"))}function initMobileScroller(){$(".date_booking").exists()&&$(".date_booking").mobiscroll().date({theme:"android-holo-light",mode:"scroller",display:"modal",dateFormat:"yy-mm-dd",onSelect:__datetimeOnSelectDelegate})}function __datetimeOnSelectDelegate(e,t){var a=$(this).val(),o=$("#frm-booking .hidden_merchant_id").val(),r="https://www.cuisine.je/mobileapp/api/get_merchant_timings";$.ajax({url:r,type:"post",data:{booking_date:a,merchant_id:o},crossDomain:!0,success:function(e){$("#table_booking_time").html(""),$("#page-booking #booking_time").html(e)}})}function search_table_timing(){$("#page-booking #diplay_timing_slots").html("");var e=$.trim($("#frm-booking #no_of_guests option:selected").val()),t=$("#frm-booking #date_booking").val(),a=$.trim($("#frm-booking #booking_time option:selected").val());if(""!=a){var o=$("#page-booking #hidden_merchant_id").val(),r="https://www.cuisine.je/mobileapp/api/check_seat_availability";$.ajax({type:"POST",url:r,crossDomain:!0,data:{no_of_guests:e,date_booking:t,time_slot:a,merchant_id:o},dataType:"json",crossDomain:!0,cache:!1,success:function(t){if(""!=$.trim(t)){var a="";$.each(t,function(t,o){var r="",n=o.seating_capacity+" seat Available";o.seating_capacity>1&&(n=o.seating_capacity+" seats Available"),0==o.seating_capacity&&(n="No Seats Available",r="disabled"),a+='<div class="mobile_time_slots"> <ons-button class="ng-isolate-scope button effect-button slide-left" value="'+o.slot_starting+'" onclick="select_booking_time(\''+t+"','"+o.seating_capacity+"','"+e+"')\" "+r+" >"+o.slot_starting+'</ons-button> <span class="available_seats_span">'+n+"</span></div>"}),$("#page-booking #diplay_timing_slots").append(a)}else toastMsg(getTrans("Sorry ! Please select a valid slot","invalid_slot"))}})}}function select_booking_time(e,t,a){$("#page-booking .booking_error_message").html("");var o=e.split("-"),r="";hours=0,o[0].length>0&&(r=o[0],hours=o[0].split(":"),hours[0].length>0&&(hours=hours[0]));var n=hours>=12?"pm":"am",a=parseInt($("'#page-booking #no_of_guests option:selected").val());if(t=parseInt(t),a>t)0==t?onsenAlert("Sorry ! No Seats Available"):onsenAlert("Sorry ! Only "+t+" seats Available","invalid_seatings");else{var a=$("#page-booking #no_of_guests option:selected").val();$("#page-booking #top_end_table_booking").css("display","none"),$("#page-booking #no_of_guests").prop("disabled","disabled"),$("#page-booking .date_booking	").prop("disabled","disabled"),$("#page-booking #booking_time").prop("disabled","disabled"),$("#page-booking .search_table_timing").prop("disabled","disabled");var i=$("#page-booking .date_booking").val(),s=($("#page-booking #table_booking_time option:selected").text(),$("#page-booking #table_booking_time option:selected").val(),i+" "+r+" "+n);$("#page-booking #user_selected_time").val(e),$("#page-booking #booking_date_time").val(s),$("#page-booking #booking_dates").val(i),$("#page-booking #txt_no_of_guests").val(a),$("#page-booking #booking_details_div").css("display","block"),$("#page-booking #hide_book_a_table").css("display","block")}}function showMerchantInfo(e){if(dump(e),1==e.enabled_table_booking?$("#book-table").hide():($("#book-table").show(),$("#page-merchantinfo #info-book").attr("onclick","popUpTableBooking("+getStorage("merchant_id","hide")+");")),$("#page-merchantinfo h3").html(e.merchant_info.restaurant_name),$("#page-merchantinfo h5").html(e.merchant_info.cuisine),$("#page-merchantinfo address").html(e.merchant_info.address),$("#page-merchantinfo .rating-stars").attr("data-score",e.merchant_info.ratings.ratings),empty(e.reviews)||$(".total-reviews").html(e.reviews.total_review+" "+getTrans("reviews","reviews")),$(".opening-hours").html(e.opening_hours),!empty(e.payment_method)){var t="";t+='<ons-list-header class="center trn" data-trn-key="payment_methods">Payment Methods</ons-list-header>',$.each($(e.payment_method),function(e,a){t+=tplPaymentListStatic(a.value,a.label,a.icon)}),createElement("merchant-payment-list",t)}initRating()}function loadBookingForm(){var e={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),"","page-booking"),initMobileScroller(),$(".number_guest").attr("placeholder",getTrans("Number Of Guests","number_of_guest")),$(".date_booking").attr("placeholder",getTrans("Date Of Booking","date_of_booking")),$(".booking_time").attr("placeholder",getTrans("Time Of Booking","time_of_booking")),$(".booking_name").attr("placeholder",getTrans("Name","name")),$(".email").attr("placeholder",getTrans("Email Address","email_address")),$(".mobile").attr("placeholder",getTrans("Mobile Number","mobile_number")),$(".booking_notes").attr("placeholder",getTrans("Your Instructions","your_instructions")),$(".hidden_merchant_id").val(getStorage("merchant_id")),translateValidationForm()}};sNavigator.pushPage("booking.html",e)}function table_booking_optn(e,t,a){var o={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(t,"","page-booking"),$("#page-booking .restauran-title").html(a),initMobileScroller(),$(".number_guest").attr("placeholder",getTrans("Number Of Guests","number_of_guest")),$(".date_booking").attr("placeholder",getTrans("Date Of Booking","date_of_booking")),$(".booking_time").attr("placeholder",getTrans("Time Of Booking","time_of_booking")),$(".booking_name").attr("placeholder",getTrans("Name","name")),$(".email").attr("placeholder",getTrans("Email Address","email_address")),$(".mobile").attr("placeholder",getTrans("Mobile Number","mobile_number")),$(".booking_notes").attr("placeholder",getTrans("Your Instructions","your_instructions")),$("#page-booking .hidden_merchant_id").val(e),translateValidationForm(),""==getStorage("client_id")||null==getStorage("client_id")||callAjax("getProfile","client_token="+getStorage("client_token"))}};sNavigator.pushPage("booking.html",o)}function submitBooking(){var e=$(".hidden_merchant_id").val();$.validate({form:"#frm-booking",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){if(""==getStorage("client_id")){var t=$("#frm-booking").serialize();return t+="&merchant_id="+e,callAjax("bookATableNewconcept",t),!1}var t=$("#frm-booking").serialize();return t+="&merchant_id="+e+"&client_id="+getStorage("client_id"),callAjax("bookATableNewconcept",t),!1}})}function loadMoreReviews(){var e=sNavigator.getCurrentPage();if("reviews.html"==e.name){var t="merchant_id="+getStorage("merchant_id");return void callAjax("merchantReviews",t)}var a={animation:"slide",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),"","page-reviews");var e="merchant_id="+getStorage("merchant_id");callAjax("merchantReviews",e)}};sNavigator.pushPage("reviews.html",a)}function displayReviews(e){var t="";$.each(e,function(e,a){t+=tplReviews(a.rating,a.client_name,a.review,a.date_created)}),createElement("review-list-scroller",t),initRating()}function showReviewForm(){var e={animation:"none",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),"","page-addreviews"),translatePage(),$(".rating").attr("placeholder",getTrans("Your Rating 1 to 5","your_rating")),$(".review").attr("placeholder",getTrans("Your reviews","your_reviews")),translateValidationForm(),$(".raty-stars").raty({score:0,readOnly:!1,path:"lib/raty/images",click:function(e,t){$(".rating").val(e)}})}};sNavigator.pushPage("addReviews.html",e)}function addReview(){$.validate({form:"#frm-addreview",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-addreview").serialize();return e+="&merchant_id="+getStorage("merchant_id"),e+="&client_token="+getStorage("client_token"),callAjax("addReview",e),!1}})}function showFilterResto(){"undefined"==typeof dialogBrowseResto||null==dialogBrowseResto||""==dialogBrowseResto?ons.createDialog("filterBrowseResto.html").then(function(e){$(".restaurant_name").val(""),e.show(),translatePage(),translateValidationForm(),$(".restaurant_name").attr("placeholder",getTrans("Enter Restaurant name","enter_resto_name"))}):($(".restaurant_name").val(""),dialogBrowseResto.show())}function submitFilterBrowse(){$.validate({form:"#frm-filterbrowse",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){dialogBrowseResto.hide();var e=$("#frm-filterbrowse").serialize();return callAjax("browseRestaurant",e),!1}})}function submitBrowseBooktable(){menu.setMainPage("BrowseByBookTable.html",{closeMenu:!0})}function showProfile(){isLogin()?menu.setMainPage("profile.html",{closeMenu:!0}):menu.setMainPage("prelogin.html",{closeMenu:!0})}function saveProfile(){$.validate({form:"#frm-profile",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-profile").serialize();return e+="&client_token="+getStorage("client_token"),callAjax("saveProfile",e),!1}})}function login(){function e(e){var t=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return t.test(e)}var t=$("#email").val();""==t?onsenAlert("Email Id is mandatory"):e(t)?$.validate({form:"#frm-login",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-login").serialize();return e+="&device_id="+getStorage("device_id"),callAjax("login",e),!1}}):onsenAlert("Invalid Email ID")}function logout(){removeStorage("client_token"),removeStorage("client_id"),onsenAlert(getTrans("You are now logged out","you_are_now_logout")),menu.setMainPage("select_dining.html",{closeMenu:!0})}function isLogin(){return empty(getStorage("client_token"))?!1:!0}function showLogin(e){var t={animation:"slide",onTransitionEnd:function(){empty(e)?($(".page-login-fb").hide(),$(".next_steps").val("")):($(".page-login-fb").show(),$(".next_steps").val(getStorage("transaction_type")))}};sNavigator.pushPage("login.html",t)}function showForgotPass(){$(".email_address").val(""),"undefined"==typeof dialogForgotPass||null==dialogForgotPass||""==dialogForgotPass?ons.createDialog("forgotPassword.html").then(function(e){e.show(),translatePage(),translateValidationForm(),$(".email_address").attr("placeholder",getTrans("Email Address","email_address"))}):dialogForgotPass.show()}function forgotPassword(){function e(e){var t=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return t.test(e)}var t=$("#frgt_email").val();""==t?onsenAlert("Email Id is mandatory"):e(t)||onsenAlert("Invalid Email ID"),$.validate({form:"#frm-forgotpass",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-forgotpass").serialize();return callAjax("forgotPassword",e),!1}})}function showSignupForm(){var e={animation:"slide",onTransitionEnd:function(){callAjax("getCustomFields",""),initIntelInputs()}};sNavigator.pushPage("signup.html",e)}function signup(){function e(e){var t=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return t.test(e)}var t=$("#pswd").val(),a=($("#fname").val(),$("#lname").val(),$("#email").val());$("#mbno").val();""==$('#frm-signup input[type="text"]').val()?onsenAlert("All fields are mandatory"):""==a?onsenAlert("Email ID is mandatory"):e(a)?t.length<6?onsenAlert("Password must be above 6 characteristics length"):""==a?onsenAlert("Email field should not be empty."):$.validate({form:"#frm-signup",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){if($(".iagree-wrap").is(":visible")){var e=$(".iagree:checked").val();if(empty(e))return void onsenAlert(getTrans("You must agree to terms & conditions","agree_terms"))}var t=$("#frm-signup").serialize();return t+="&device_id="+getStorage("device_id"),callAjax("signup",t),!1}}):onsenAlert("Invalid Email ID")}function showOrders(){isLogin()?menu.setMainPage("orders.html",{closeMenu:!0}):menu.setMainPage("prelogin.html",{closeMenu:!0})}function showHistory(){isLogin()?menu.setMainPage("history.html",{closeMenu:!0}):menu.setMainPage("prelogin.html",{closeMenu:!0})}function showAddressBook(){isLogin()?menu.setMainPage("addressBook.html",{closeMenu:!0}):menu.setMainPage("prelogin.html",{closeMenu:!0})}function displayOrderHistory(e){var t="<ons-list>";$.each(e,function(e,a){t+='<ons-list-item modifier="tappable" class="list-item-container" onclick="showOrderOptions('+a.order_id+');" >',t+='<ons-row class="row">',t+='<ons-col class="col-orders concat-text">',t+=a.title,t+="</ons-col>",t+='<ons-col class="col-order-stats center" width="98px">',t+='<span class="notification concat-text '+a.status_raw+' ">'+a.status+"</span>",t+="</ons-col>",t+="</ons-row>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("recent-orders",t)}function displayBookingHistory(e){var t="<ons-list>";$.each(e,function(e,a){t+='<ons-list-item modifier="tappable" class="list-item-container" onclick="showHistoryDetails('+a.booking_id+');" >',t+='<ons-row class="row">',t+='<ons-col class="col-orders concat-text">',t+="#"+a.booking_id+"  "+a.booking_name+"  "+a.date_booking,t+="</ons-col>",t+='<ons-col class="col-order-stats center" width="98px">',t+='<span class="notification concat-text '+a.status+' ">'+a.status+"</span>",t+="</ons-col>",t+="</ons-row>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("recent-history",t)}function showOrderDetails(e){dump(e);var t={animation:"slide",onTransitionEnd:function(){var t="client_token="+getStorage("client_token")+"&order_id="+e;callAjax("ordersDetails",t)}};sNavigator.pushPage("ordersDetails.html",t)}function displayOrderHistoryDetails(e){$("#page-orderdetails .title").html(getTrans("Total","total")+" : "+e.total),$("#page-orderdetails #search-text").html(getTrans("Order Details","order_details")+" #"+e.order_id);var t='<ons-list-header class="center trn" data-trn-key="items" >Items</ons-list-header>';e.item.length>0?$.each(e.item,function(e,a){t+='<ons-list-item class="center">'+a.item_name+"</ons-list-item> "}):(t+='<ons-list-item class="center">',t+="no item found",t+="</ons-list-item>"),createElement("item-details",t);var t='<ons-list-header class="center trn" data-trn-key="status_history">Status History</ons-list-header>';if(e.history_data.length>0?$.each(e.history_data,function(e,a){dump(a),t+="<ons-list-item>",t+='<ons-row class="row">',t+='<ons-col class="" width="40%">',t+=a.date_created,t+="</ons-col>",t+='<ons-col class="padding-left5" width="30%">',t+=a.status,t+="</ons-col>",t+='<ons-col class="padding-left5"  width="25%">',t+=a.remarks,t+="</ons-col>",t+="</ons-row>",t+="</ons-list-item>"}):(t+='<ons-list-item class="center">',t+="No history found",t+="</ons-list-item>"),createElement("item-history",t),"mobile_app"==e.order_from.request_from){var a='<button class="button green-btn button--large trn" onclick="reOrder('+e.order_id+');" data-trn-key="click_here_to_reorder" >';a+="Click here to Re-order",a+='<div class="search-btn"><ons-icon icon="ion-forward"></ons-icon></div>',a+="</button>",createElement("re-order-wrap",a)}translatePage()}function displayBookingHistoryDetails(e){$.each(e,function(e,t){$("#page-booking-history #search-text").html(getTrans("Booking History ","booking_details")+" #"+t.booking_id);var a="";$("#booking_status").val(t.status);var a='<ons-list-header class="header list__header ons-list-header-inner">';a+='<ons-row class="row ons-row-inner">',a+='<span class="notification margin2 '+t.status+' ">'+t.status+"</span>",a+="</ons-row>",a+="</ons-list-header>",a+='<ons-list-header class="header list__header ons-list-header-inner">',a+='<ons-row class="row ons-row-inner">Details</ons-row>',a+="</ons-list-header>",a+='<ons-list-item class="list__item ons-list-item-inner">',a+='<ons-row class="row ons-row-inner">',a+='<ons-col class=" col ons-col-inner">Booking Name</ons-col>',a+='<ons-col class="text-right col ons-col-inner">'+t.booking_name+"</ons-col>",a+="</ons-row>",a+="</ons-list-item>",a+='<ons-list-item class="list__item ons-list-item-inner">',a+='<ons-row class="row ons-row-inner">',a+='<ons-col class=" col ons-col-inner">Restarunt Name</ons-col>',a+='<ons-col class="text-right col ons-col-inner">'+t.restaurant_name+"</ons-col>",a+="</ons-row>",a+="</ons-list-item>",a+='<ons-list-item class="list__item ons-list-item-inner">',a+='<ons-row class="row ons-row-inner">',a+='<ons-col class=" col ons-col-inner">Number Of Guests</ons-col>',a+='<ons-col class="text-right col ons-col-inner">'+t.number_guest+"</ons-col>",a+="</ons-row>",a+="</ons-list-item>",a+='<ons-list-item class="list__item ons-list-item-inner">',a+='<ons-row class="row ons-row-inner">',a+='<ons-col class=" col ons-col-inner">Date Of Booking</ons-col>',a+='<ons-col class="text-right col ons-col-inner">'+t.date_booking+"</ons-col>",a+="</ons-row>",a+="</ons-list-item>",a+='<ons-list-item class="list__item ons-list-item-inner">',a+='<ons-row class="row ons-row-inner">',a+='<ons-col class=" col ons-col-inner">Time</ons-col>',a+='<ons-col class="text-right col ons-col-inner">'+t.booking_time+"</ons-col>",a+="</ons-row>",a+="</ons-list-item>",createElement("booking-details",a)})}function reOrder(e){var t="client_token="+getStorage("client_token")+"&order_id="+e;callAjax("reOrder",t)}function displayAddressBook(e){var t="<ons-list>";e.length>0&&$.each(e,function(e,a){t+='<ons-list-item modifier="tappable" onclick="modifyAddressBook('+a.id+');" >',t+='<ons-row class="row">',t+='<ons-col class="" width="70%">',t+='<p class="small-font-dim">'+a.address+"</p>",t+="</ons-col>",t+='<ons-col class="text-right" >',2==a.as_default&&(t+='<ons-icon icon="ion-ios-location-outline"></ons-icon>'),t+="</ons-col>",t+="<ons-row>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("address-book-list",t)}function modifyAddressBook(e){dump(e);var t={animation:"slide",onTransitionEnd:function(){var t="client_token="+getStorage("client_token")+"&id="+e;callAjax("getAddressBookDetails",t)}};sNavigator.pushPage("addressBookDetails.html",t)}function fillAddressBook(e){$(".action").val("edit"),$(".delete-addressbook").show(),$(".id").val(e.id),$(".street").val(e.street),$(".city").val(e.city),$(".state").val(e.state),$(".zipcode").val(e.zipcode),$(".location_name").val(e.location_name),$(".country_code").val(e.country_code),2==e.as_default?$(".as_default").attr("checked","checked"):$(".as_default").removeAttr("checked")}function saveAddressBook(){$.validate({form:"#frm-addressbook",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-addressbook").serialize();return e+="&client_token="+getStorage("client_token"),callAjax("saveAddressBook",e),!1}})}function newAddressBook(){$(".delete-addressbook").hide();var e={animation:"slide",onTransitionEnd:function(){$(".id").val(""),$(".action").val("add")}};sNavigator.pushPage("addressBookDetails.html",e)}function deleteAddressBook(){ons.notification.confirm({message:getTrans("Delete this records?","delete_this_records"),title:dialog_title_default,buttonLabels:["Yes","No"],animation:"default",primaryButtonIndex:1,cancelable:!0,callback:function(e){if(dump(e),0==e){var t=$(".id").val(),a="&client_token="+getStorage("client_token")+"&id="+t;callAjax("deleteAddressBook",a)}}})}function popUpAddressBook(){$(".manual-address-input").hide(),$("#del-addrs").hide(),"undefined"==typeof dialogAddressBook||null==dialogAddressBook||""==dialogAddressBook?ons.createDialog("dialogAddressBook.html").then(function(e){e.show(),translatePage()}):dialogAddressBook.show()}function popUpTableBooking(e,t,a,o){"hide"==o&&merhantPopOverMenu.hide(),"undefined"==typeof dialogBooking||null==dialogBooking||""==dialogBooking?ons.createDialog("bookingDialog.html").then(function(t){t.show(),translatePage(),initMobileScroller(),$(".number_guest").attr("placeholder",getTrans("Number Of Guests","number_of_guest")),$(".date_booking").attr("placeholder",getTrans("Date Of Booking","date_of_booking")),$(".booking_time").attr("placeholder",getTrans("Time Of Booking","time_of_booking")),$(".booking_name").attr("placeholder",getTrans("Name","name")),$(".email").attr("placeholder",getTrans("Email Address","email_address")),$(".mobile").attr("placeholder",getTrans("Mobile Number","mobile_number")),$("#page-booking .hidden_merchant_id").val(e),$(".booking_notes").attr("placeholder",getTrans("Your Instructions","your_instructions")),translateValidationForm(),""==getStorage("client_id")||null==getStorage("client_id")||callAjax("getProfile","client_token="+getStorage("client_token"))}):($("#page-booking #no_of_guests").val(""),$("#page-booking #booking_time").val(""),$("#page-booking #date_booking").val(""),$("#page-booking #user_selected_time").val(""),$("#page-booking .hidden_merchant_id").val(e),$("#no_of_guests").prop("disabled",!1),$("#date_booking").prop("disabled",!1),$("#booking_time").prop("disabled",!1),$("#page-booking #diplay_timing_slots").html(""),$(".search_table_timing").prop("disabled",!1),$("#page-booking #top_end_table_booking").show(),$("#page-booking #hide_book_a_table").hide(),translatePage(),""==getStorage("client_id")||null==getStorage("client_id")||callAjax("getProfile","client_token="+getStorage("client_token")),dialogBooking.show()),$("#page-booking .hidden_merchant_id").val(e)}function displayAddressBookPopup(e){var t="<ons-list>";e.length>0&&$.each(e,function(e,a){var o=a.street+"|";o+=a.city+"|",o+=a.state+"|",o+=a.zipcode+"|",o+=a.location_name+"|",o+=a.contact_phone+"|",t+='<ons-list-item modifier="tappable" class="setAddress" data-address="'+o+'" >',t+='<ons-row class="row">',t+='<ons-col class="" width="80%">',t+='<p class="small-font-dim">'+a.address+"</p>",t+="</ons-col>",t+='<ons-col class="text-right" >',2==a.as_default&&(t+='<ons-icon icon="ion-ios-location-outline"></ons-icon>'),t+="</ons-col>",t+="<ons-row>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("addressbook-popup",t)}function initFacebook(){if(dump("initFacebook"),empty(krms_config.facebookAppId))$(".fb-loginbutton").hide();else{var e=getStorage("facebook_flag");2==e?($(".fb-loginbutton").show(),openFB.init({appId:krms_config.facebookAppId})):$(".fb-loginbutton").hide()}}function myFacebookLogin(){openFB.login(function(e){"connected"===e.status?getFbInfo():alert("Facebook login failed: "+e.error)},{scope:"public_profile,email"})}function getFbInfo(){openFB.api({path:"/me",params:{fields:"email,first_name,last_name"},success:function(e){dump(e);var t="&email="+e.email;t+="&first_name="+e.first_name,t+="&last_name="+e.last_name,t+="&fbid="+e.id,t+="&device_id="+getStorage("device_id"),$(".next_steps").exists()&&(t+="&next_steps="+$(".next_steps").val()),callAjax("registerUsingFb",t)},error:fbErrorHandler})}function fbErrorHandler(e){alert("ERROR=> "+e.message)}function FBlogout(){openFB.logout(function(){onsenAlert("Logout successful")},fbErrorHandler)}function paypalSuccessfullPayment(e){var t="response="+e;t+="&order_id="+getStorage("order_id"),t+="&client_token="+getStorage("client_token"),callAjax("paypalSuccessfullPayment",t)}function citypaySuccessfullPayment(e){var t="response="+e;t+="&order_id="+getStorage("order_id"),t+="&client_token="+getStorage("client_token"),callAjax("citypaySuccessfullPayment",t)}function showNotification(e,t){"undefined"==typeof pushDialog||null==pushDialog||""==pushDialog?ons.createDialog("pushNotification.html").then(function(a){$(".push-title").html(e),$(".push-message").html(t),a.show()}):($(".push-title").html(e),$(".push-message").html(t),pushDialog.show())}function showOrders2(){pushDialog.hide(),isLogin()?menu.setMainPage("orders.html",{closeMenu:!0}):menu.setMainPage("prelogin.html",{closeMenu:!0})}function initMerchantMap(e){if(dump(e),empty(e))$("#merchant-map").hide();else{var t=new GoogleMap;t.initialize("merchant-map",e.lat,e.lng,15)}}function getCurrentLocation(){"iOS"==device.platform?getCurrentLocationOld():cordova.plugins.locationAccuracy.request(onRequestSuccess,onRequestFailure,cordova.plugins.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY)}function onRequestSuccess(){loader.show(),navigator.geolocation.getCurrentPosition(geolocationSuccess,geolocationError,{timeout:1e4,enableHighAccuracy:getLocationAccuracy()})}function onRequestFailure(e){4==e.code?(toastMsg(getTrans("You have choosen not to turn on location accuracy","turn_off_location")),getCurrentLocation()):toastMsg(e.message)}function getCurrentLocationOld(){CheckGPS.check(function(){loader.show(),navigator.geolocation.getCurrentPosition(geolocationSuccess,geolocationError,{timeout:1e4,enableHighAccuracy:getLocationAccuracy()})},function(){var e=getTrans("Your GPS is disabled, this app needs to be enabled to work.","your_gps"),t=getTrans("Use GPS for location.","use_gps_for_location"),a=getTrans("Improve location accuracy","improve_location_accuracy"),o=getTrans("Cancel","cancel"),r=getTrans("Later","later"),n=getTrans("Go","go");cordova.dialogGPS(e,t,function(e){switch(e){case 0:break;case 1:break;case 2:}},a+"?",[o,r,n])})}function geolocationSuccess(e){dump(e);var t="lat="+e.coords.latitude;t+="&lng="+e.coords.longitude,callAjax("reverseGeoCoding",t)}function geolocationError(e){hideAllModal(),toastMsg(e.message)}function saveSettings(){setStorage("country_code_set",$(".country_code_set").val());var e=$("#frm-settings").serialize();e+="&client_token="+getStorage("client_token"),e+="&device_id="+getStorage("device_id"),callAjax("saveSettings",e)}function showLocationPopUp(){"undefined"==typeof locationDialog||null==locationDialog||""==locationDialog?ons.createDialog("locationOptions.html").then(function(e){e.show(),translatePage()}):locationDialog.show()}function displayLocations(e){var t="";t+="<ons-list>",t+='<ons-list-header class="list-header trn" data-trn-key="country">Country</ons-list-header>',$.each(e.list,function(a,o){ischecked="",a==e.selected&&(ischecked='checked="checked"'),t+='<ons-list-item modifier="tappable" onclick="setCountry(\''+a+"');\">",t+='<label class="radio-button checkbox--list-item">',t+='<input type="radio" name="country_code" class="country_code" value="'+a+'" '+ischecked+" >",t+='<div class="radio-button__checkmark checkbox--list-item__checkmark"></div>',t+=" "+o,t+="</label>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("location-options-list",t),translatePage()}function setCountry(e){$(".country_code_set").val(e),setStorage("country_code_set",e)}function addressPopup(){"undefined"==typeof addressDialog||null==addressDialog||""==addressDialog?ons.createDialog("addressPopup.html").then(function(e){e.show({callback:geoCompleteChangeAddress}),translatePage(),translateValidationForm(),$(".new_s").attr("placeholder",getTrans("Enter your address","enter_your_address"))}):addressDialog.show({callback:geoCompleteChangeAddress})}function changeAddress(){$.validate({form:"#frm-adddresspopup",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){dump("change address"),sNavigator.popPage({cancelIfRunning:!0}),setStorage("search_address",$(".new_s").val());var e=JSON.stringify(cart);return saveCartToDb()&&(e=""),callAjax("loadCart","merchant_id="+getStorage("merchant_id")+"&search_address="+encodeURIComponent($(".new_s").val())+"&cart="+e+"&transaction_type="+getStorage("transaction_type")+"&device_id="+getStorage("device_id")),!1}})}function geoCompleteChangeAddress(){dump("country_code_set=>"+getStorage("country_code_set")),empty(getStorage("country_code_set"))?$("#new_s").geocomplete():$("#new_s").geocomplete({country:getStorage("country_code_set")}),$(".pac-container").css({"z-index":99999})}function showNotificationCampaign(e,t){"undefined"==typeof pushcampaignDialog||null==pushcampaignDialog||""==pushcampaignDialog?ons.createDialog("pushNotificationCampaign.html").then(function(a){$("#page-notificationcampaign .push-title").html(e),$("#page-notificationcampaign .push-message").html(t),
a.show()}):($("#page-notificationcampaign .push-title").html(e),$("#page-notificationcampaign .push-message").html(t),pushcampaignDialog.show())}function itemNotAvailable(e){switch(e){case 1:toastMsg(getTrans("item not available","item_not_available"));break;case 2:return void toastMsg(getTrans("Ordering is disabled","ordering_disabled"))}}function number_format(e,t,a,o){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var r=isFinite(+e)?+e:0,n=isFinite(+t)?Math.abs(t):0,i="undefined"==typeof o?",":o,s="undefined"==typeof a?".":a,l="",c=function(e,t){var a=Math.pow(10,t);return""+(Math.round(e*a)/a).toFixed(t)};return l=(n?c(r,n):""+Math.round(r)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(l[1]||"").length<n&&(l[1]=l[1]||"",l[1]+=new Array(n-l[1].length+1).join("0")),l.join(s)}function getLanguageSettings(){if(hasConnection()){var e="&client_token="+getStorage("client_token");callAjax("getLanguageSettings",e)}}function translatePage(){if(dump("TranslatePage"),"undefined"!=typeof getStorage("translation")&&null!=getStorage("translation")&&""!=getStorage("translation")&&(dictionary=JSON.parse(getStorage("translation")),!empty(dictionary))){var e=getStorage("default_lang");"undefined"!=e&&""!=e&&(dump("INIT TRANSLATE"),translator=$("body").translate({lang:e,t:dictionary}))}}function getTrans(e,t){var a="";if("undefined"!=getStorage("translation")&&(a=JSON.parse(getStorage("translation"))),!empty(a)){var o=getStorage("default_lang");if("undefined"!=o&&""!=o&&array_key_exists(t,a))return a[t][o]}return e}function array_key_exists(e,t){return!t||t.constructor!==Array&&t.constructor!==Object?!1:e in t}function translateValidationForm(){$.each($(".has_validation"),function(){var e=$(this).data("validation");switch(e){case"number":$(this).attr("data-validation-error-msg",getTrans("The input value was not a correct number","validation_numeric"));break;case"required":$(this).attr("data-validation-error-msg",getTrans("this field is mandatory!","validaton_mandatory"));break;case"email":$(this).attr("data-validation-error-msg",getTrans("You have not given a correct e-mail address!","validation_email"))}})}function showLanguageList(){"undefined"==typeof languageOptions||null==languageOptions||""==languageOptions?ons.createDialog("languageOptions.html").then(function(e){e.show(),translatePage()}):languageOptions.show()}function displayLanguageSelection(e){var t=getStorage("default_lang");dump("selected=>"+t);var a="";a+="<ons-list>",a+='<ons-list-header class="list-header trn" data-trn-key="language">Language</ons-list-header>',$.each(e,function(e,o){dump(o.lang_id),ischecked="",o.lang_id==t&&(ischecked='checked="checked"'),a+='<ons-list-item modifier="tappable" onclick="setLanguage(\''+o.lang_id+"');\">",a+='<label class="radio-button checkbox--list-item">',a+='<input type="radio" name="country_code" class="country_code" value="'+o.lang_id+'" '+ischecked+" >",a+='<div class="radio-button__checkmark checkbox--list-item__checkmark"></div>',a+=" "+o.language_code,a+="</label>",a+="</ons-list-item>"}),a+="</ons-list>",createElement("language-options-list",a),translatePage()}function setLanguage(e){return dump(getStorage("translation")),"undefined"==typeof getStorage("translation")||null==getStorage("translation")||""==getStorage("translation")?(languageOptions.hide(),void ons.notification.confirm({message:"Language file has not been loaded, would you like to reload?",title:dialog_title_default,buttonLabels:["Yes","No"],animation:"none",primaryButtonIndex:1,cancelable:!0,callback:function(e){(0==e||"0"==e)&&getLanguageSettings()}})):getStorage("translation").length<=5?void onsenAlert("Translation file is not yet ready."):void(empty(e)||(setStorage("default_lang",e),empty(translator)?translator=$("body").translate({lang:e,t:dictionary}):translator.lang(e)))}function applyVoucher(){if(checkIfhasOfferDiscount())return!1;if(voucher_code=$(".voucher_code").val(),""!=voucher_code){var e="voucher_code="+voucher_code;e+="&client_token="+getStorage("client_token"),e+="&merchant_id="+getStorage("merchant_id"),e+="&cart_sub_total="+getStorage("cart_sub_total"),e+="&cart_delivery_charges="+getStorage("cart_delivery_charges"),e+="&cart_packaging="+getStorage("cart_packaging"),e+="&cart_tax="+getStorage("cart_tax"),e+="&pts_redeem_amount="+$(".pts_redeem_amount").val(),empty(getStorage("tips_percentage"))&&setStorage("tips_percentage",0),e+="&tips_percentage="+getStorage("tips_percentage"),callAjax("applyVoucher",e)}else onsenAlert(getTrans("invalid voucher code","invalid_voucher_code"))}function removeVoucher(){$(".voucher_amount").val(""),$(".voucher_type").val(""),$(".voucher_code").val(""),$(".apply-voucher").show(),$(".remove-voucher").hide(),$(".voucher-header").html(getTrans("Voucher","voucher")),$(".total-amount").html(prettyPrice(getStorage("order_total_raw")))}function deviceBackReceipt(){return!1}function prettyPrice(e){dump(e);var t=getStorage("decimal_place"),a=getStorage("currency_position"),o=getStorage("currency_set"),r=getStorage("thousand_separator"),n=getStorage("decimal_separator");return dump("decimal_place=>"+t),dump("currency_symbol=>"+o),dump("thousand_separator=>"+r),dump("decimal_separator=>"+n),dump("currency_position=>"+a),e=number_format(e,t,n,r),"left"==a?o+" "+e:e+" "+o}function showExpirationMonth(){"undefined"==typeof ExpirationMonthDialog||null==ExpirationMonthDialog||""==ExpirationMonthDialog?ons.createDialog("ExpirationMonth.html").then(function(e){e.show(),translatePage()}):ExpirationMonthDialog.show()}function fillExpirationMonth(){var e="";for(e+="<ons-list>",e+='<ons-list-header class="list-header trn" data-trn-key="expiration_month">Expiration Month</ons-list-header>',i=1;i<13;i++)i<=9&&(i="0"+i),e+='<ons-list-item modifier="tappable" onclick="setExpirationMonth(\''+i+"');\">",e+='<label class="radio-button checkbox--list-item">',e+='<input type="radio" name="expiration_m" class="expiration_m" value="'+i+'"  >',e+='<div class="radio-button__checkmark checkbox--list-item__checkmark"></div>',e+=" "+i,e+="</label>",e+="</ons-list-item>";e+="</ons-list>",createElement("expiration-options-list",e),translatePage()}function setExpirationMonth(e){$(".expiration_month").val(e),$(".expiration_month_label").html(e),ExpirationMonthDialog.hide()}function showExpirationYear(){"undefined"==typeof showExpirationYearDialog||null==showExpirationYearDialog||""==showExpirationYearDialog?ons.createDialog("showExpirationYearDialog.html").then(function(e){e.show(),translatePage()}):showExpirationYearDialog.show()}function fillExpirationYear(){var e=new Date,t=e.getFullYear(),a="";for(a+="<ons-list>",a+='<ons-list-header class="list-header trn" data-trn-key="expiration_year">Expiration Year</ons-list-header>',i=0;i<15;i++)years=parseInt(t)+i,a+='<ons-list-item modifier="tappable" onclick="setExpirationYear(\''+years+"');\">",a+='<label class="radio-button checkbox--list-item">',a+='<input type="radio" name="expiration_m" class="expiration_m" value="'+years+'"  >',a+='<div class="radio-button__checkmark checkbox--list-item__checkmark"></div>',a+=" "+years,a+="</label>",a+="</ons-list-item>";a+="</ons-list>",createElement("expiration-year-options-list",a),translatePage()}function setExpirationYear(e){dump(e),$(".expiration_yr").val(e),$(".expiration_year").html(e),showExpirationYearDialog.hide()}function showCountry(){"undefined"==typeof showCountryDialog||null==showCountryDialog||""==showCountryDialog?ons.createDialog("showCountryDialog.html").then(function(e){e.show(),translatePage()}):showCountryDialog.show()}function fillCountryList(){var e="";e+="<ons-list>",e+='<ons-list-header class="list-header trn" data-trn-key="expiration_year">Country List</ons-list-header>',$.each(country_json_list,function(t,a){"GB"==a.code&&(e+='<ons-list-item modifier="tappable" onclick="setCardCountry(\''+a.code+"');\">",e+='<label class="radio-button checkbox--list-item">',e+='<input type="radio" name="expiration_m" class="expiration_m" value="'+a.code+'"  >',e+='<div class="radio-button__checkmark checkbox--list-item__checkmark"></div>',e+=" "+a.name,e+="</label>",e+="</ons-list-item>")}),e+="</ons-list>",createElement("country-options-list",e)}function setCardCountry(e){$(".x_country").val(e),$(".country_label").html(e),showCountryDialog.hide()}function atzPayNow(){$.validate({form:"#frm-atz",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-atz").serialize();return e+="&client_token="+getStorage("client_token"),e+="&merchant_id="+getStorage("merchant_id"),e+="&earned_points="+getStorage("earned_points"),callAjax("PayAtz",e),!1}})}function cpyPayNow(){var e=$(".cc_number").val(),t=$(".cvv").val();(e="")?onsenAlert("Credit number is required!"):e.length<11?onsenAlert("Credit number must not be less than 12 characteristics length!"):""==t?onsenAlert("CVV number is required!"):t.length<2?onsenAlert("CVV number must not be less than 3 characteristics length!"):$.validate({form:"#frm-cpy",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-cpy").serialize();return e+="&client_token="+getStorage("client_token"),e+="&merchant_id="+getStorage("merchant_id"),e+="&earned_points="+getStorage("earned_points"),callAjax("Paycpy",e),!1}})}function stripePayNow(){var e=getStorage("stripe_publish_key");dump(e),$.validate({form:"#frm-stp",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){loader.show();var t=$(".cc_number").val(),a=$(".cvv").val(),o=$(".expiration_month").val(),r=$(".expiration_yr").val();return Stripe.setPublishableKey(e),Stripe.card.createToken({number:t,cvc:a,exp_month:o,exp_year:r},stripeResponseHandler),!1}})}function stripeResponseHandler(e,t){if(dump("stripe response"),dump(e),dump(t),t.error)hideAllModal(),onsenAlert(t.error.message);else{$(".stripe_token").val(t.id);var a=$("#frm-stp").serialize();a+="&client_token="+getStorage("client_token"),a+="&merchant_id="+getStorage("merchant_id"),callAjax("PayStp",a)}}function autoAddToCart(e,t,a){if(2==$("#close_store").val()||1==$("#merchant_open").val())return void onsenAlert(getTrans("This Restaurant Is Closed Now.  Please Check The Opening Times","restaurant_close"));dump(e),dump(t),cart[cart.length]={item_id:e,qty:1,price:t,sub_item:[],cooking_ref:[],ingredients:[],order_notes:"",discount:a},dump(cart);var o={item_id:e,qty:1,price:t,sub_item:[],cooking_ref:[],ingredients:[],order_notes:"",discount:a};saveCartToDb()?callAjax("addToCart","cart="+JSON.stringify(o)+"&device_id="+getStorage("device_id")):toastMsg(getTrans("Item added to cart","item_added_to_cart")),showCartNosOrder()}function validateCLient(){$.validate({form:"#frm-signup-validation",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-signup-validation").serialize();return callAjax("validateCLient",e),!1}})}function detailsPTS(e){dump(e);var t={animation:"slide",onTransitionEnd:function(){callAjax("detailsPTS","client_token="+getStorage("client_token")+"&pts_type="+e)}};sNavigator.pushPage("detailsPTS.html",t)}function displayPTSdetails(e){if(e.length>0){var t='<ons-list class="list-dim-text">';$.each(e,function(e,a){t+='<ons-list-item  class="list-item-container" >',t+='<ons-row class="row">',t+='<ons-col width="100px" >',t+=a.date_created,t+="</ons-col>",t+="<ons-col >",t+=a.label,t+="</ons-col>",t+='<ons-col width="20px" >',t+=a.points,t+="</ons-col>",t+="</ons-row>",t+="</ons-list-item>"}),t+="</ons-list>",createElement("scroller-pts-details",t)}}function applyRedeem(){if(checkIfhasOfferDiscount())return!1;if(redeem_points=$(".redeem_points").val(),""!=redeem_points){var e="redeem_points="+redeem_points;e+="&client_token="+getStorage("client_token"),e+="&merchant_id="+getStorage("merchant_id"),e+="&voucher_amount="+$(".voucher_amount").val(),e+="&subtotal_order="+getStorage("cart_sub_total"),e+="&cart_sub_total="+getStorage("cart_sub_total"),e+="&cart_delivery_charges="+getStorage("cart_delivery_charges"),e+="&cart_packaging="+getStorage("cart_packaging"),e+="&cart_tax="+getStorage("cart_tax"),empty(getStorage("tips_percentage"))&&setStorage("tips_percentage",0),e+="&tips_percentage="+getStorage("tips_percentage"),callAjax("applyRedeemPoints",e)}else onsenAlert(getTrans("invalid redeem points","invalid_redeem_points"))}function cancelRedeem(){$(".pts_redeem_points").val(""),$(".pts_redeem_amount").val(""),$(".pts_pts").show(),$(".pts_pts_cancel").hide(),$(".total-amount").html(prettyPrice(getStorage("order_total_raw")))}function backtoHome(){var e={closeMenu:!0,animation:"slide"};menu.setMainPage("select_dining.html",e)}function exitKApp(){ons.notification.confirm({message:getTrans("Are you sure to close the app?","close_app"),title:dialog_title_default,buttonLabels:[getTrans("Yes","yes"),getTrans("No","no")],animation:"default",primaryButtonIndex:1,cancelable:!0,callback:function(e){0==e&&(navigator.app?navigator.app.exitApp():navigator.device?navigator.device.exitApp():window.close())}})}function imageLoaded(e){$(e).imagesLoaded().always(function(e){console.log("all images loaded")}).done(function(e){console.log("all images successfully loaded")}).fail(function(){console.log("all images loaded, at least one is broken")}).progress(function(e,t){var a=t.isLoaded?"loaded":"broken";t.img.parentNode.className=(t.isLoaded,""),console.log("image is "+a+" for "+t.img.src)})}function limitText(e,t){var a=$(e),o=a.val();o.length>=t&&a.val(function(){return o.substr(0,t)})}function toastMsg(e){return isDebug()?void onsenAlert(e):void 0}function isDebug(){return!1}function showEasyCategory(e){"undefined"==typeof myPopover||null==myPopover||""==myPopover?ons.createPopover("popover.html").then(function(t){t.show(e,{animation:"none"}),createElement("category-pop-over-list",easy_category_list)}):(myPopover.show(e),myPopover.on("postshow",function(e){createElement("category-pop-over-list",easy_category_list)}))}function fillPopOverCategoryList(e){var t="<ons-list>";e.length>0&&$.each(e,function(e,a){t+='<ons-list-item modifier="tappable" onclick="loadmenu2('+a.category_id+","+a.merchant_id+');"  >'+a.category_name+"</ons-list-item>"}),t+="</ons-list>",dump(t),easy_category_list=t}function loadmenu2(e,t){callAjax("getItemByCategory","cat_id="+e+"&merchant_id="+t),myPopover.hide()}function showMenu(e){"undefined"==typeof merhantPopOverMenu||null==merhantPopOverMenu||""==merhantPopOverMenu?ons.createPopover("merchantmenu.html").then(function(t){t.show(e,{animation:"none"}),enabled_table_booking=getStorage("enabled_table_booking"),2==enabled_table_booking?($(".book_table_menu").show(),$("#merchnt-pop-menu #bookid-mer").attr("onclick","popUpTableBooking("+getStorage("merchant_id")+",'','','hide');")):$(".book_table_menu").hide(),translatePage()}):(merhantPopOverMenu.show(e),merhantPopOverMenu.on("preshow",function(e){enabled_table_booking=getStorage("enabled_table_booking"),2==enabled_table_booking?($(".book_table_menu").show(),$("#merchnt-pop-menu #bookid-mer").attr("onclick","popUpTableBooking("+getStorage("merchant_id")+",'hide');")):$(".book_table_menu").hide()}),translatePage())}function loadPageMerchantInfo(){var e={animation:"none",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),"","page-merchantinfo"),callAjax("getMerchantInfo","merchant_id="+getStorage("merchant_id"))}};sNavigator.pushPage("merchantInfo.html",e),merhantPopOverMenu.hide()}function loadBookingForm1(){merhantPopOverMenu.hide(),loadBookingForm()}function loadMoreReviews1(){merhantPopOverMenu.hide(),loadMoreReviews()}function loadMap(){merhantPopOverMenu.hide();var e={animation:"none",onTransitionEnd:function(){checkGPS()}};sNavigator.pushPage("map.html",e)}function checkGPS(){if(isDebug())return void viewTaskMapInit();if("iOS"==device.platform)return void viewTaskMapInit();var e=!0;cordova.plugins.locationAccuracy.canRequest(function(t){if(!t){e=!1;var a=getTrans("Your device has no access to location Would you like to switch to the Location Settings page and do this manually?","location_off");ons.notification.confirm({message:a,title:dialog_title_default,buttonLabels:["Yes","No"],animation:"none",primaryButtonIndex:1,cancelable:!0,callback:function(e){(0==e||"0"==e)&&cordova.plugins.diagnostic.switchToLocationSettings()}})}}),e&&cordova.plugins.locationAccuracy.request(onRequestSuccessMap,onRequestFailureMap,cordova.plugins.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY)}function onRequestSuccessMap(e){viewTaskMapInit()}function onRequestFailureMap(e){4==e.code?(toastMsg(getTrans("You have choosen not to turn on location accuracy","turn_off_location")),checkGPS()):toastMsg(e.message)}function viewTaskMapInit(){merchant_latitude=getStorage("merchant_latitude"),merchant_longtitude=getStorage("merchant_longtitude"),dump(merchant_latitude),dump(merchant_longtitude),google_lat=new plugin.google.maps.LatLng(merchant_latitude,merchant_longtitude),setTimeout(function(){var e=document.getElementById("map_canvas_div");$("#map_canvas_div").css("height",$(window).height()-$("#map_canvas_div").offset().top),map=plugin.google.maps.Map.getMap(e,{camera:{latLng:google_lat,zoom:17}}),map.on(plugin.google.maps.event.MAP_READY,onMapInit)},500)}function onMapInit(){merchant_latitude=getStorage("merchant_latitude"),merchant_longtitude=getStorage("merchant_longtitude"),delivery_address=getStorage("merchant_address");new plugin.google.maps.LatLng(merchant_latitude,merchant_longtitude);map.clear(),map.off(),map.setCenter(merchant_latitude,merchant_longtitude),map.setZoom(17),map.addMarker({position:new plugin.google.maps.LatLng(merchant_latitude,merchant_longtitude),title:delivery_address,snippet:getTrans("Destination","destination"),icon:{url:getStorage("destination_icon")}},function(e){e.showInfoWindow(),navigator.geolocation.getCurrentPosition(function(e){var t=new plugin.google.maps.LatLng(e.coords.latitude,e.coords.longitude),a=new plugin.google.maps.LatLng(merchant_latitude,merchant_longtitude);map.addPolyline({points:[a,t],color:"#AA00FF",width:10,geodesic:!0},function(e){map.animateCamera({target:t,zoom:17,tilt:30},function(){var e=[{title:getTrans("You are here","you_are_here"),position:t,icon:{url:getStorage("from_icon")}}];hideAllModal(),addMarkers(e,function(e){e[e.length-1].showInfoWindow()})})})},function(e){hideAllModal(),toastMsg(e.message)},{timeout:1e4,enableHighAccuracy:getLocationAccuracy()})})}function addMarkers(e,t){function a(a){o.push(a),o.length===e.length&&t(o)}var o=[];e.forEach(function(e){map.addMarker(e,a)})}function getLocationAccuracy(){var e=navigator.connection.type;switch(e){case"Connection.WIFI":case"wifi":return!1;default:return!0}}function viewTaskDirection(){merchant_latitude=getStorage("merchant_latitude"),merchant_longtitude=getStorage("merchant_longtitude"),navigator.geolocation.getCurrentPosition(function(e){var t=new plugin.google.maps.LatLng(e.coords.latitude,e.coords.longitude),a=new plugin.google.maps.LatLng(merchant_latitude,merchant_longtitude);plugin.google.maps.external.launchNavigation({from:t,to:a})},function(e){toastMsg(e.message)},{timeout:1e4,enableHighAccuracy:getLocationAccuracy()})}function initIntelInputs(){var e=getStorage("mobile_country_code");dump(e),empty(e)?$(".mobile_inputs").intlTelInput({autoPlaceholder:!1,autoHideDialCode:!0,nationalMode:!1,autoFormat:!1,utilsScript:"lib/intel/lib/libphonenumber/build/utils.js"}):$(".mobile_inputs").intlTelInput({autoPlaceholder:!1,defaultCountry:e,autoHideDialCode:!0,nationalMode:!1,autoFormat:!1,utilsScript:"lib/intel/lib/libphonenumber/build/utils.js"})}function showVerifyAccountPage(){var e={animation:"slide",onTransitionEnd:function(){}};sNavigator.pushPage("verify-account.html",e)}function verifyAccount(){$.validate({form:"#frm-verify-account",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-verify-account").serialize();return callAjax("verifyAccount",e),!1}})}function checkIfhasOfferDiscount(){var e=getStorage("has_discount");return empty(e)||1!=e?!1:(onsenAlert(getTrans("you request cannot be applied you have offer discount already","discount_offer")),!0)}function showPageAdressSelection(){var e={animation:"slide",onTransitionEnd:function(){}};sNavigator.pushPage("address-selection.html",e)}function showManualAddressInput(){$("#del-addrs").hide(),$(".manual-address-input").toggle()}function setManualAddress(){$.validate({form:"#frm-manual-address",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){$(".street").val($(".stree_1").val()),$(".city").val($(".city_1").val()),$(".state").val($(".state_1").val()),$(".zipcode").val($(".zipcode_1").val());var e=$(".stree_1").val();return e+=" "+$(".city_1").val(),e+=" "+$(".state_1").val(),e+=" "+$(".zipcode_1").val(),$(".google_lat").val(""),$(".google_lng").val(""),$(".formatted_address").val(""),$(".delivery-address-text").val(e),$(".manual-address-input").toggle(),$("#del-addrs").show(),!1}})}function showMapAddress(e){$("#del-addrs").hide(),setStorage("map_address_action",e);var t={animation:"none",onTransitionEnd:function(){checkGPS_AddressMap()}};sNavigator.pushPage("address-bymap.html",t)}function checkGPS_AddressMap(){if($("#map_canvas_address").css("height",$(window).height()-$("#map_canvas_address").offset().top),$(".search_address_geo").exists()){dump("checkGPS_AddressMap"),$(".map_search_field_wrap").css("height","auto"),$(document).on("click","#search_address_geo",function(){$(".map_search_field_wrap").css("height",$(window).height()-$(".map_search_field_wrap").offset().top),$(".search_address_geo").val("")});var e=getStorage("country_code_set");empty(getStorage("country_code_set"))&&(e=""),$(".search_address_geo").geocomplete({country:e}).bind("geocode:result",function(e,t){dump(t),$(".map_search_field_wrap").css("height","auto");var a="",o="",r="",n="",i="",s="",l="";if(i=t.formatted_address,$.each(t.address_components,function(){switch(this.types[0]){case"postal_code":n=this.short_name;break;case"street_address":a=this.short_name;break;case"administrative_area_level_1":r=this.short_name;break;case"locality":o=this.short_name}}),dump("formatted_address=>"+i),dump("address=>"+a),dump("city=>"+o),dump("state=>"+r),dump("zip=>"+n),s=t.geometry.location.lat(),l=t.geometry.location.lng(),!isDebug()){var c=new plugin.google.maps.LatLng(s,l);map_search.getCameraPosition(function(e){map_search.setCenter(c),map_search.setZoom(e.zoom),drag_marker.setPosition(c),drag_marker.setTitle(i),drag_marker.showInfoWindow()})}var d=getStorage("map_address_action");dump(d),setStorage("map_address_result_address",a),setStorage("map_address_result_city",o),setStorage("map_address_result_state",r),setStorage("map_address_result_zip",n),setStorage("map_address_result_formatted_address",i),setStorage("google_lat",t.geometry.location.lat()),setStorage("google_lng",t.geometry.location.lng())})}if(!isDebug()){if("iOS"==device.platform)return void MapInit_addressMap();var t=!0;cordova.plugins.locationAccuracy.canRequest(function(e){if(!e){t=!1;var a=getTrans("Your device has no access to location Would you like to switch to the Location Settings page and do this manually?","location_off");ons.notification.confirm({message:a,title:dialog_title_default,buttonLabels:["Yes","No"],animation:"none",primaryButtonIndex:1,cancelable:!0,callback:function(e){(0==e||"0"==e)&&cordova.plugins.diagnostic.switchToLocationSettings()}})}}),t&&cordova.plugins.locationAccuracy.request(function(e){MapInit_addressMap()},function(e){4==e.code?checkGPS_AddressMap():toastMsg(e.message)},cordova.plugins.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY)}}function MapInit_addressMap(){loader.show(),drag_marker_bounce=1,navigator.geolocation.getCurrentPosition(function(e){var t=new plugin.google.maps.LatLng(e.coords.latitude,e.coords.longitude);setTimeout(function(){var a=document.getElementById("map_canvas_address");$("#map_canvas_address").css("height",$(window).height()-$("#map_canvas_address").offset().top),map_search=plugin.google.maps.Map.getMap(a,{camera:{latLng:t,zoom:17}}),map_search.setBackgroundColor("white"),map_search.addEventListener(plugin.google.maps.event.MAP_READY,function(a){map_search.clear(),map_search.off(),map_search.setCenter(t),map_search.setZoom(17),callAjax("coordinatesToAddress","lat="+e.coords.latitude+"&lng="+e.coords.longitude),map_search.addEventListener(plugin.google.maps.event.MAP_CLICK,function(e){var t=e.toUrlValue();t=explode(",",t)}),map_search.addEventListener(plugin.google.maps.event.CAMERA_CHANGE,function(e){var t=new plugin.google.maps.LatLng(e.target.lat,e.target.lng);2==drag_marker_bounce&&(drag_marker.setPosition(t),drag_marker.hideInfoWindow(),$(".change_cemara_action").val("getAddress"),$(".change_cemara_lat").val(e.target.lat),$(".change_cemara_lng").val(e.target.lng),$(".use-location").html(getTrans("Get Address","get_address")))})})},500)},function(e){hideAllModal(),toastMsg(e.message)},{timeout:1e4,enableHighAccuracy:getLocationAccuracy()})}function useThisLocation(){var e=$(".change_cemara_action").val();if("getAddress"==e){var t=$(".change_cemara_lat").val(),a=$(".change_cemara_lng").val();return $(".change_cemara_action").val(""),$(".use-location").html(getTrans("Use this address","use_this_address")),void callAjax("dragMarker","lat="+t+"&lng="+a)}var o=getStorage("map_address_action");switch(dump(o),o){case"mapaddress":$(".street").val(getStorage("map_address_result_address")),$(".city").val(getStorage("map_address_result_city")),$(".state").val(getStorage("map_address_result_state")),$(".zipcode").val(getStorage("map_address_result_zip")),$(".google_lat").val(getStorage("google_lat")),$(".google_lng").val(getStorage("google_lng")),$(".formatted_address").val(getStorage("map_address_result_formatted_address")),$(".delivery-address-text").val(getStorage("map_address_result_formatted_address")),$("#del-addrs").show(),sNavigator.popPage({cancelIfRunning:!0});break;case"changeaddress":sNavigator.popPage({cancelIfRunning:!0}),setStorage("search_address",getStorage("map_address_result_formatted_address"));var r=JSON.stringify(cart);if(saveCartToDb())var r="";callAjax("loadCart","merchant_id="+getStorage("merchant_id")+"&search_address="+encodeURIComponent(getStorage("search_address"))+"&cart="+r+"&transaction_type="+getStorage("transaction_type")+"&device_id="+getStorage("device_id")),sNavigator.popPage({cancelIfRunning:!0});break;default:sNavigator.popPage({cancelIfRunning:!0})}}function showChangeAddressPage(e){var t={animation:"slide",onTransitionEnd:function(){}};sNavigator.pushPage("change-address.html",t)}function showOrderOptions(e){dump(e);var t={animation:"none",onTransitionEnd:function(){$(".order_option_order_id").val(e)}};sNavigator.pushPage("order-options.html",t)}function showHistoryDetails(e){dump(e);var t={animation:"none",onTransitionEnd:function(){var t="client_token="+getStorage("client_token")+"&booking_id="+e+"&client_id="+getStorage("client_id");callAjax("getBookingDetails",t),$(".booking_id").val(e)}};sNavigator.pushPage("booking_history.html",t)}function showOrderDetails2(){showOrderDetails($(".order_option_order_id").val())}function reOrder2(){reOrder($(".order_option_order_id").val())}function showTrackPage(){var e={animation:"slide",onTransitionEnd:function(){var e="order_id="+$(".order_option_order_id").val();e+="&client_token="+getStorage("client_token"),callAjax("trackOrderHistory",e),stopTrackInterval()}};sNavigator.pushPage("track-order.html",e)}function showTrackingPage(){var e={animation:"none",onTransitionEnd:function(){$(".driver_avatar").attr("src",$(".driver_avatar").val()),$("._driver_name").html($(".driver_name").val()),$(".call_driver").attr("href","tel:"+$(".driver_phone").val()),MapInit_Track()}};sNavigator.pushPage("tracking-page.html",e)}function MapInit_Track(){if(!isDebug()){var e=$(".driver_lat").val(),t=$(".driver_lng").val(),a=$(".task_lat").val(),o=$(".task_lng").val(),r=new plugin.google.maps.LatLng(e,t),n=new plugin.google.maps.LatLng(a,o);setTimeout(function(){var e=document.getElementById("map_canvas_track");$("#map_canvas_track").css("height",$(window).height()-$("#map_canvas_track").offset().top),map=plugin.google.maps.Map.getMap(e,{camera:{latLng:r,zoom:17}}),map.setBackgroundColor("white"),map.addEventListener(plugin.google.maps.event.MAP_READY,function(e){e.clear(),e.off(),e.setCenter(r),e.setZoom(17),e.addMarker({position:r,title:$(".driver_name").val(),snippet:getTrans("Driver name","driver_name"),icon:{url:$(".driver_icon").val()}},function(t){t.showInfoWindow(),e.addPolyline({points:[r,n],color:"#AA00FF",width:10,geodesic:!0},function(t){e.animateCamera({target:n,zoom:17,tilt:30},function(){var e=[{title:$(".delivery_address").val(),position:n,snippet:getTrans("Delivery Address","delivery_address"),icon:{url:$(".address_icon").val()}}];addMarkers(e,function(e){e[e.length-1].showInfoWindow(),e[e.length-1].setAnimation(plugin.google.maps.Animation.BOUNCE)})})}),stopTrackMapInterval(),track_order_map_interval=setInterval(function(){runTrackMap()},1e4)})})},500)}}function submitContactForm(){$.validate({form:"#frm-enter-contact",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-enter-contact").serialize();return e+="&client_token="+getStorage("client_token"),callAjax("saveContactNumber",e),!1}})}function playNotification(){var e="file:///android_asset/www/audio/fb-alert.mp3";dump(e),empty(e)||playAudio(e)}function playAudio(e){my_media=new Media(e,function(){dump("playAudio():Audio Success"),my_media.stop(),my_media.release()},function(e){dump("playAudio():Audio Error: "+e)}),my_media.play()}function stopNotification(){my_media.stop(),my_media.release()}function saveCartToDb(){var e=getStorage("mobile_save_cart_db");return 1==e?!0:!1}function runTrackOrder(){if($("#page-track-order").is(":visible")){dump("runTrackOrder");var e="order_id="+$(".order_option_order_id").val();e+="&client_token="+getStorage("client_token"),callAjax("trackOrderHistory",e)}else dump("stop runTrackOrder"),stopTrackInterval()}function reRunTrackOrder(){stopTrackInterval(),track_order_interval=setInterval(function(){runTrackOrder()},7e3)}function reRunTrackOrder2(){sNavigator.popPage({cancelIfRunning:!0}),stopTrackInterval(),track_order_interval=setInterval(function(){runTrackOrder()},7e3)}function stopTrackInterval(){clearInterval(track_order_interval)}function stopTrackMapInterval(){clearInterval(track_order_map_interval)}function runTrackMap(){if($("#tracking-page").is(":visible")){dump("runTrackMap"),stopTrackMapInterval();var e="order_id="+$(".order_option_order_id").val();e+="&client_token="+getStorage("client_token"),callAjax("trackOrderMap",e)}else dump("stop runTrackMap"),stopTrackMapInterval()}function reInitTrackMap(e){dump("reInitTrackMap"),dump(e);var t=e.driver_lat,a=e.driver_lng,o=e.task_lat,r=e.task_lng;if(isDebug())return dump("driver location=>"+t+":"+a),void dump("task location=>"+o+":"+r);var n=new plugin.google.maps.LatLng(t,a),i=new plugin.google.maps.LatLng(o,r);map.getCameraPosition(function(e){var t=["Current camera position:\n","latitude:"+e.target.lat,"longitude:"+e.target.lng,"zoom:"+e.zoom,"tilt:"+e.tilt,"bearing:"+e.bearing].join("\n"),a=new plugin.google.maps.LatLng(e.target.lat,e.target.lng);map.clear(),map.off(),map.setCenter(a),map.setZoom(e.zoom);var t=[{title:$(".driver_name").val(),position:n,snippet:getTrans("Driver name","driver_name"),icon:{url:$(".driver_icon").val()}},{title:$(".delivery_address").val(),position:i,snippet:getTrans("Delivery Address","delivery_address"),icon:{url:$(".address_icon").val()}}];addMarkers(t,function(e){map.addPolyline({points:[n,i],color:"#AA00FF",width:10,geodesic:!0},function(e){})}),stopTrackMapInterval(),track_order_map_interval=setInterval(function(){runTrackMap()},9e3)})}function showTip(){"undefined"==typeof tipsDialog||null==tipsDialog||""==tipsDialog?ons.createDialog("tipsDialog.html").then(function(e){e.show(),translatePage()}):tipsDialog.show()}function setTips(e){removeStorage("remove_tips"),setStorage("tips_percentage",e),$(".tip_amount").html(getTrans("Tips","tips")+" "+e+"%"),
tipsDialog.hide(),reloadCart()}function removeTips(){removeStorage("tips_percentage"),setStorage("remove_tips",1),tipsDialog.hide(),reloadCart()}function reloadCart(){var e=JSON.stringify(cart);if(saveCartToDb())var e="";empty(getStorage("tips_percentage"))&&setStorage("tips_percentage",0);var t="";t="merchant_id="+getStorage("merchant_id")+"&search_address="+encodeURIComponent(getStorage("search_address"))+"&cart="+e+"&transaction_type="+getStorage("transaction_type")+"&device_id="+getStorage("device_id")+"&tips_percentage="+getStorage("tips_percentage"),empty(getStorage("remove_tips"))||(t+="&remove_tips="+getStorage("remove_tips")),callAjax("loadCart",t)}function fillCCList(e){var t="";e.length>0&&($.each(e,function(e,a){t+='<ons-list-item modifier="tappable" onclick="setCC('+a.cc_id+');" >',t+=a.credit_card_number,t+="</ons-list-item>"}),createElement("cc-list",t))}function setCC(e){ons.notification.confirm({message:getTrans("Choose action","choose_action"),title:"",buttonLabels:[getTrans("Use this card","use_this_card"),getTrans("Edit this card","edit_this_card")],animation:"default",primaryButtonIndex:1,cancelable:!0,callback:function(t){switch(dump(t),t){case 0:setStorage("cc_id",e),sNavigator.popPage({cancelIfRunning:!0});break;case 1:var a={animation:"slide",onTransitionEnd:function(){translatePage(),translateValidationForm();var t="&client_token="+getStorage("client_token");t+="&cc_id="+e,callAjax("loadCC",t)}};sNavigator.pushPage("ccform.html",a)}}})}function showCCForm(){var e={animation:"slide",onTransitionEnd:function(){translatePage(),translateValidationForm(),$(".delete-cc").hide(),$(".cc_number").attr("placeholder",getTrans("Enter Card Number","cc_number")),$(".cvv").attr("placeholder",getTrans("CVV","cvv")),$(".card_name").attr("placeholder",getTrans("Card name","card_name")),$(".billing_address").attr("placeholder",getTrans("Billing Address","billing_address"))}};sNavigator.pushPage("ccform.html",e)}function saveCC(){$.validate({form:"#frm-cc",borderColorOnError:"#FF0000",onError:function(){},onSuccess:function(){var e=$("#frm-cc").serialize();return e+="&client_token="+getStorage("client_token"),callAjax("saveCreditCard",e),!1}})}function deleteCC(){ons.notification.confirm({message:getTrans("Delete this records?","delete_this_records"),title:dialog_title_default,buttonLabels:["Yes","No"],animation:"default",primaryButtonIndex:1,cancelable:!0,callback:function(e){if(0==e){var t="";t+="&client_token="+getStorage("client_token"),t+="&cc_id="+$(".cc_id").val(),callAjax("deleteCreditCard",t)}}})}function fillShippingAddress(){empty(getStorage("map_address_result_formatted_address"))||($(".delivery-address-text").html(getStorage("map_address_result_formatted_address")),$(".street").val(getStorage("map_address_result_address")),$(".city").val(getStorage("map_address_result_city")),$(".state").val(getStorage("map_address_result_state")),$(".zipcode").val(getStorage("map_address_result_zip")),$(".formatted_address").val(getStorage("map_address_result_formatted_address")),$(".google_lat").val(getStorage("google_lat")),$(".google_lng").val(getStorage("google_lng")))}var ajax_url=krms_config.ApiUrl,dialog_title_default=krms_config.DialogDefaultTitle,search_address,ajax_request,cart=[],networkState,easy_category_list="",map,map_search,drag_marker,map_track,track_order_interval,track_order_map_interval,drag_marker_bounce=1;document.addEventListener("deviceready",onDeviceReady,!1),document.addEventListener("offline",noNetConnection,!1),jQuery.fn.exists=function(){return this.length>0},$(document).on("keyup",".numeric_only",function(){this.value=this.value.replace(/[^0-9\.]/g,"")}),ons.ready(function(){dump("ready"),$("#s").val(getStorage("search_address")),refreshConnection(),isDebug()&&setStorage("device_id","device_555"),$(document).on("click","#s",function(){$("#s").val("")})}),document.addEventListener("pageinit",function(e){switch(dump("pageinit"),dump("pagname => "+e.target.id),e.target.id){case"menucategory-page":case"page-merchantinfo":case"page-reviews":case"page-cart":case"page-receipt":case"page-change-address":case"page-order-options":case"page-track-order":case"page-map":case"tracking-page":translatePage();break;case"address-bymap":translatePage(),$(".search_address_geo").attr("placeholder",getTrans("Street Address,City,State","home_search_placeholder"));break;case"page-enter-contact":translatePage(),$(".contact_phone").attr("placeholder",getTrans("Mobile Phone","mobile_number")),translateValidationForm();break;case"page-booking":translatePage(),$(".number_guest").attr("placeholder",getTrans("Number Of Guests","number_of_guest")),initIntelInputs();break;case"page-paymentoption":translatePage(),$(".order_change").attr("placeholder",getTrans("change? For how much?","order_change"));break;case"page-addressbook-details":translatePage(),translateValidationForm(),$(".street").attr("placeholder",getTrans("Street","street")),$(".city").attr("placeholder",getTrans("City","city")),$(".state").attr("placeholder",getTrans("State","state")),$(".zipcode").attr("placeholder",getTrans("Post Code","zipcode")),$(".location_name").attr("placeholder",getTrans("Location name","location_name"));break;case"page-signup":translatePage(),translateValidationForm(),$(".first_name").attr("placeholder",getTrans("First Name","first_name")),$(".last_name").attr("placeholder",getTrans("Last Name","last_name")),$(".contact_phone").attr("placeholder",getTrans("Mobile Phone","contact_phone")),$(".email_address").attr("placeholder",getTrans("Email address","email_address")),$(".password").attr("placeholder",getTrans("Password","password")),$(".cpassword").attr("placeholder",getTrans("Confirm Password","confirm_password"));break;case"page-checkoutsignup":translatePage(),translateValidationForm(),$(".first_name").attr("placeholder",getTrans("First Name","first_name")),$(".last_name").attr("placeholder",getTrans("Last Name","last_name")),$(".contact_phone").attr("placeholder",getTrans("Mobile Phone","contact_phone")),$(".email_address").attr("placeholder",getTrans("Email address","email_address")),$(".password").attr("placeholder",getTrans("Password","password")),$(".cpassword").attr("placeholder",getTrans("Confirm Password","confirm_password"));break;case"page-shipping":$(".street").attr("placeholder",getTrans("Street","street")),$(".city").attr("placeholder",getTrans("City","city")),$(".state").attr("placeholder",getTrans("State","state")),$(".zipcode").attr("placeholder",getTrans("Post Code","zipcode")),$(".contact_phone").attr("placeholder",getTrans("Contact phone","contact_phone")),$(".location_name").attr("placeholder",getTrans("Apartment suite, unit number, or company name","location_name2")),$(".delivery_instruction").attr("placeholder",getTrans("Delivery instructions","delivery_instruction")),translatePage(),translateValidationForm(),initIntelInputs();var t=getStorage("customer_contact_number");empty(t)||$(".contact_phone").val(t);break;case"searchresult-page":$("#search-text").html("Take Away"),callAjax("search_take_away","type=1&address="+getStorage("search_address")+"&cuisine="+getStorage("cuisine")+"&parish="+getStorage("parish"));break;case"page-home":geoComplete(),search_address=getStorage("search_address"),"undefined"==typeof search_address||null==search_address||""==search_address||setTimeout('$("#s").val(search_address)',1e3),translatePage(),$("#s").attr("placeholder",getTrans("Street Address,City,State","home_search_placeholder"));break;case"page-filter-options":callAjax("cuisineList","");break;case"page-filter-option":callAjax("cuisineLists","");break;case"page-filter-optn":callAjax("cuisinLists","");break;case"page-browse":callAjax("browseRestaurant",""),translatePage();break;case"page-table-booking":callAjax("BrowseByBookTable",""),translatePage();break;case"page-profile":callAjax("getProfile","client_token="+getStorage("client_token")),translatePage(),$("#page-profile .profile-pic-wrap").show(),translateValidationForm(),$(".first_name").attr("placeholder",getTrans("First Name","first_name")),$(".last_name").attr("placeholder",getTrans("Last Name","last_name")),$(".email_address").attr("placeholder",getTrans("Email Address","email_address")),$(".password").attr("placeholder",getTrans("Password","password"));break;case"page-orders":callAjax("getOrderHistory","client_token="+getStorage("client_token")),translatePage();break;case"page-history":callAjax("getBookingHistory","client_token="+getStorage("client_token")+"&client_id="+getStorage("client_id")),translatePage();break;case"page-addressbook":callAjax("getAddressBook","client_token="+getStorage("client_token")),translatePage();break;case"page-dialog-addressbook":callAjax("getAddressBookDialog","client_token="+getStorage("client_token"));break;case"page-login":case"page-prelogin":initFacebook(),translatePage(),translateValidationForm(),$(".email_address").attr("placeholder",getTrans("Email address","email_address")),$(".password").attr("placeholder",getTrans("Password","password"));break;case"page-settings":callAjax("getSettings","device_id="+getStorage("device_id")),translatePage();break;case"page-locations":callAjax("mobileCountryList","device_id="+getStorage("device_id"));break;case"page-languageoptions":callAjax("getLanguageSelection","");break;case"page-expirationmonth":fillExpirationMonth();break;case"page-expiration-year":fillExpirationYear();break;case"page-show-country":fillCountryList();break;case"page-pts":dump("page-pts"),callAjax("getPTS","client_token="+getStorage("client_token")),translatePage();break;case"page-atz-form":translatePage(),translateValidationForm(),$(".cc_number").attr("placeholder",getTrans("Credit Card Number","cc_number")),$(".cvv").attr("placeholder",getTrans("CVV","cvv")),$(".x_first_name").attr("placeholder",getTrans("First Name","first_name")),$(".x_last_name").attr("placeholder",getTrans("Last Name","last_name")),$(".x_address").attr("placeholder",getTrans("Address","address")),$(".x_city").attr("placeholder",getTrans("City","city")),$(".x_state").attr("placeholder",getTrans("State","state")),$(".x_zip").attr("placeholder",getTrans("Post Code","zipcode"));break;case"page-cpy-form":translatePage(),translateValidationForm(),$(".cc_number").attr("placeholder",getTrans("Enter Card Number","cc_number")),$(".cvv").attr("placeholder",getTrans("CVV","cvv")),$(".x_first_name").attr("placeholder",getTrans("First Name","first_name")),$(".x_last_name").attr("placeholder",getTrans("Last Name","last_name")),$(".x_address").attr("placeholder",getTrans("Address","address")),$(".x_city").attr("placeholder",getTrans("City","city")),$(".x_state").attr("placeholder",getTrans("State","state")),$(".x_zip").attr("placeholder",getTrans("Post Code","zipcode"));break;case"page-stripe-form":translatePage(),translateValidationForm(),$(".cc_number").attr("placeholder",getTrans("Credit Card Number","cc_number")),$(".cvv").attr("placeholder",getTrans("CVV","cvv"));break;case"page-verify-account":$(".code").attr("placeholder",getTrans("Code","code")),$(".email_address").attr("placeholder",getTrans("Email Address","email_address")),translatePage(),translateValidationForm();break;case"page-address-selection":translatePage(),translateValidationForm(),$(".stree_1").attr("placeholder",getTrans("Street","street")),$(".city_1").attr("placeholder",getTrans("City","city")),$(".state_1").attr("placeholder",getTrans("State","state")),$(".zipcode_1").attr("placeholder",getTrans("Post Code","zipcode"))}},!1),ons.bootstrap(),jQuery(document).ready(function(){$(document).on("click",".price",function(){var e=$(".item_id").val(),t=$(this).val().replace(/\s/g,""),a="item_id="+e;a+="&size="+t+"&merchant_id="+getStorage("merchant_id"),callAjax("LoadAddOns",a),setCartValue()}),$(document).on("click",".get_addons",function(){var e=$(".item_id").val(),t=$("input[name=price]:checked").val().replace(/\s/g,""),a="item_id="+e;a+="&size="+t+"&merchant_id="+getStorage("merchant_id"),callAjax("LoadAddOns",a)}),$(document).on("change",".qty",function(){setCartValue()}),$(document).on("change",".sub_item",function(){setCartValue()}),$(document).on("change",".subitem-qty",function(){setCartValue()}),$(document).on("click",".edit-order",function(){editOrderInit()}),$(document).on("click",".order-apply-changes",function(){applyCartChanges()}),$(document).on("click",".delete-item",function(){var e=$(this).data("id"),t=$(this).parent().parent().parent();t.remove(),$(".subitem-row"+e).remove()}),$(document).on("click",".sub_item_custom",function(){var e=$(this),t=$(this).data("multi");if(!empty(t)){var a=$(this).data("id"),o=0;return $(".sub_item_custom:checked").each(function(){$(this).data("id")==a&&o++}),o>t?(onsenAlert(getTrans("Sorry but you can select only","sorry_but_you_can_select")+" "+t+" "+getTrans("addon","addon")),void e.attr("checked",!1)):void 0}}),$(document).on("click",".transaction_type",function(){var e=$(this).val();"pickup"==e?$(".delivery_asap_wrap").hide():$(".delivery_asap_wrap").show(),setStorage("transaction_type",e);var t=JSON.stringify(cart);saveCartToDb()&&(t="");var a="&delivery_date="+$(".delivery_date").val();empty($(".delivery_time").val())||(a+="&delivery_time="+$(".delivery_time").val()),callAjax("loadCart","merchant_id="+getStorage("merchant_id")+"&search_address="+encodeURIComponent(getStorage("search_address"))+"&cart="+t+"&transaction_type="+getStorage("transaction_type")+a+"&device_id="+getStorage("device_id"))}),$(document).on("click",".payment_list",function(){dump($(this).val());var e=$(".paypal_card_fee").val();switch($(this).val()){case"paypal":case"pyp":if(e>0){var t=parseFloat(getStorage("order_total_raw"))+parseFloat(e);t=number_format(t,2),$(".total-amount").html(getStorage("cart_currency_symbol")+" "+t)}$(".order-change-wrapper").hide(),$(".payon-delivery-wrapper").hide();break;case"cod":e>0&&$(".total-amount").html(getStorage("order_total")),$(".order-change-wrapper").show(),$(".payon-delivery-wrapper").hide();break;case"pyr":e>0&&$(".total-amount").html(getStorage("order_total")),$(".order-change-wrapper").hide(),$(".payon-delivery-wrapper").show();break;case"ocr":var a={animation:"slide",onTransitionEnd:function(){var e="merchant_id="+getStorage("merchant_id");e+="&client_token="+getStorage("client_token"),callAjax("getMerchantCClist",e),translatePage()}};sNavigator.pushPage("cclist.html",a);break;default:e>0&&$(".total-amount").html(getStorage("order_total")),$(".order-change-wrapper").hide(),$(".payon-delivery-wrapper").hide()}}),$(document).on("click",".logo-wrap img",function(){var e=sNavigator.getCurrentPage();if(dump("pagename=>"+e.name),"merchantInfo.html"!=e.name){var t={animation:"none",onTransitionEnd:function(){displayMerchantLogo2(getStorage("merchant_logo"),"","page-merchantinfo"),callAjax("getMerchantInfo","merchant_id="+getStorage("merchant_id"))}},a=!1,o=sNavigator.getPages();return dump(o.length),o.length>0&&$.each(o,function(e,t){empty(t)||(dump(t.name),"merchantInfo.html"==t.name&&(dump("found"),a=!0,sNavigator.popPage()))}),a?void dump("exit"):void sNavigator.pushPage("merchantInfo.html",t)}}),$(document).on("click",".setAddress",function(){var e=$(this).data("address"),t=e.split("|");if(dump(t),t.length>0){$(".street").val(t[0]),$(".city").val(t[1]),$(".state").val(t[2]),$(".zipcode").val(t[3]),$(".location_name").val(t[4]);var a="";empty(t[5])||(a=t[5]),$(".contact_phone").val(a);var o=t[0];o+=" "+t[1],o+=" "+t[2],o+=" "+t[3],$(".delivery-address-text").val(o),$(".google_lat").val(""),$(".google_lng").val(""),$(".formatted_address").val(""),dialogAddressBook.hide(),$("#del-addrs").show()}else onsenAlert(getTrans("Error: cannot set address book","cannot_set_address")),dialogAddressBook.hide()})}),ons.ready(function(){menu.on("preopen",function(){if(console.log("Menu page is going to open"),isLogin()){dump("logon ok");var e=getStorage("pts");dump("pts=>"+e),2!=e?$(".menu-pts").hide():$(".menu-pts").css({display:"block"}),$(".logout-menu").css({display:"block"});var t=getStorage("avatar");dump("avatar=>"+t),empty(t)||(dump("fillavatar"),$(".profile-pic-wrap").show(),$(".avatar").attr("src",getStorage("avatar")),$(".avatar-right").html(getStorage("client_name_cookie")),$(".avatar-wrap-menu div").addClass("img_loaded"))}else dump("logon not"),$(".logout-menu").hide(),$(".profile-pic-wrap").hide(),$(".menu-pts").hide();translatePage()}),menu.on("postopen",function(){dump("menu is open"),imageLoaded(".img_loaded")})}),$(document).on("keypress",".numbers",function(e){return 8!=e.which&&0!=e.which&&(e.which<48||e.which>57)?!1:void 0});var translator,dictionary;$(document).ready(function(){$(".inputTextBox").keypress(function(e){var t=e.charCode;t>=65&&120>=t||32==t||0==t||e.preventDefault()})}),$(document).on("keyup",".limit_char",function(){var e=$(this).data("maxl");e=parseInt(e),limitText(this,e)});var rzr_successCallback=function(e){var t="payment_id="+e;t+="&order_id="+getStorage("order_id"),t+="&client_token="+getStorage("client_token"),callAjax("razorPaymentSuccessfull",t)},rzr_cancelCallback=function(e){onsenAlert(e.description+" (Error "+e.code+")")},my_media;